{"title":"《恶意代码分析实战》实验","uid":"ff3b385e81d2e459aa67c54453b93307","slug":"《恶意代码分析实战》实验","date":"2020-11-26T16:25:37.000Z","updated":"2022-08-22T07:46:57.462Z","comments":true,"path":"api/articles/《恶意代码分析实战》实验.json","keywords":null,"cover":"http://browser9.qhimg.com/bdm/480_296_0/t0128e904ff207c846b.jpg","content":"<h1 id=\"1\"><a href=\"#1\" class=\"headerlink\" title=\"1\"></a>1</h1><p><a href=\"https://down.52pojie.cn/Tools/\">https://down.52pojie.cn/Tools/</a></p>\n<p>1-1：</p>\n<p><a href=\"https://www.virustotal.com/gui/\">https://www.virustotal.com/gui/</a></p>\n<p><a href=\"https://www.virscan.org/\">https://www.virscan.org/</a></p>\n<p>pe.jpg</p>\n<p>PEiD</p>\n<p>PEtools</p>\n<p>1-2:</p>\n<p>脱壳机FUPX—改源文件</p>\n<p>sysinternal&#x2F;strings.exe</p>\n<p>lab1-3:</p>\n<p>3</p>\n<p>linxerunpacker–&gt;unpacked.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508215140041.png\" alt=\"image-20210508215140041\"></p>\n<p>strings unpacked.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508215428749.png\" alt=\"image-20210508215428749\"></p>\n<p>1-4：</p>\n<p>PEtools：编译时间被伪造</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508220342177.png\" alt=\"image-20210508220342177\"></p>\n<p>advapi32.dll</p>\n<p>提权</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508220714785.png\" alt=\"image-20210508220714785\"></p>\n<p>网址 文件</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508221128657.png\" alt=\"image-20210508221128657\"></p>\n<p>功能</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508221204496.png\" alt=\"image-20210508221204496\"></p>\n<p>resource hacker–&gt;action-&gt;save as *.bin  </p>\n<p>petools：01-04是exe<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508222025299.png\" alt=\"image-20210508222025299\"></p>\n<p>PEiD：子系统 输入表 DLL API</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508222418638.png\" alt=\"image-20210508222418638\"></p>\n<h1 id=\"3\"><a href=\"#3\" class=\"headerlink\" title=\"3\"></a>3</h1><h2 id=\"3-1\"><a href=\"#3-1\" class=\"headerlink\" title=\"3-1\"></a>3-1</h2><p>【静态分析】peid加壳</p>\n<p>strings注册表位置  网址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508222955925.png\" alt=\"image-20210508222955925\"></p>\n<p>【动态分析】</p>\n<p>开启wireshark： 版本要求vista以上，可用win7测，或用fiddler~</p>\n<p>运行3-1.exe【慎！！！VM里运行】  , procexp: </p>\n<p>handles: mutant互斥量_WinVMX32   【对res在同一时刻只有一个对象能对其访问】</p>\n<p>DLLs：联网</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508224430957.png\" alt=\"image-20210508224430957\"></p>\n<p>procmon: filter</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508224531587.png\" alt=\"image-20210508224531587\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508224556812.png\" alt=\"image-20210508224556812\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508224826388.png\" alt=\"image-20210508224826388\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508225010178.png\" alt=\"image-20210508225010178\"></p>\n<p>seed 随机数生成</p>\n<p>regedit注册表      加入自启动项</p>\n<p>比较大小和md5值：说明3-1.exe将self拷贝到了system32下vmx32to64.exe</p>\n<p>wireshark：双击：协议 内容</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508225411372.png\" alt=\"image-20210508225411372\"></p>\n<p>DNS域名解析<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210508225540379.png\" alt=\"image-20210508225540379\"></p>\n<p>连外网 SSL：每次随机字符     定期发送不断广播256B数据包【随机数据】</p>\n<h2 id=\"3-2-dll\"><a href=\"#3-2-dll\" class=\"headerlink\" title=\"3-2.dll\"></a>3-2.dll</h2><p>输出表：服务 安装self</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509092507362.png\" alt=\"image-20210509092507362\"></p>\n<p>输入表：服务sc 注册表reg  Inet  http</p>\n<p>dll的某个宿主程序svchost.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509092805191.png\" alt=\"image-20210509092805191\"></p>\n<p>regshot注册表快照：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509093019876.png\" alt=\"image-20210509093019876\"></p>\n<p>1.运行该dll</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509093035506.png\" alt=\"image-20210509093035506\"></p>\n<p>proexp中rundll32.exe不存在了，运行完毕。</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509093143908.png\" alt=\"image-20210509093143908\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509093252786.png\" alt=\"image-20210509093252786\"></p>\n<p>key  创建服务</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509093403078.png\" alt=\"image-20210509093403078\"></p>\n<p>val   5.as识别其的指纹特征</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509093509409.png\" alt=\"image-20210509093509409\"></p>\n<p>wireshark：start</p>\n<p>promon</p>\n<p>procexp</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509093740324.png\" alt=\"image-20210509093740324\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509093757421.png\" alt=\"image-20210509093757421\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509093924524.png\" alt=\"image-20210509093924524\"></p>\n<p>4</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509093949290.png\" alt=\"image-20210509093949290\"></p>\n<p>wireshark: dns</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509094123690.png\" alt=\"image-20210509094123690\"></p>\n<p>http</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509094147747.png\" alt=\"image-20210509094147747\"></p>\n<h2 id=\"3-3\"><a href=\"#3-3\" class=\"headerlink\" title=\"3-3\"></a>3-3</h2><p>procexp: run后消失，留下孤儿进程svchost.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509095340982.png\" alt=\"image-20210509095340982\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509095426229.png\" alt=\"image-20210509095426229\"></p>\n<p>键盘记录，保存进该log文件中！！！</p>\n<p>mem有而image磁盘里没有按键相关API出现，是可移的内存修改操作！</p>\n<p>exp：PID 1640</p>\n<p>mon：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509095751044.png\" alt=\"image-20210509095751044\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509095828195.png\" alt=\"image-20210509095828195\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509095854257.png\" alt=\"image-20210509095854257\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509095924288.png\" alt=\"image-20210509095924288\"></p>\n<p>桌面创建文件，记录输入内容+打开的程序：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509100026714.png\" alt=\"image-20210509100026714\"></p>\n<p>目的：svchost启动keyboard记录器</p>\n<h2 id=\"3-4-自删除\"><a href=\"#3-4-自删除\" class=\"headerlink\" title=\"3-4 自删除\"></a>3-4 自删除</h2><p>peid</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509100320773.png\" alt=\"image-20210509100320773\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509100333910.png\" alt=\"image-20210509100333910\"></p>\n<p>获取系统目录，copy到指定目录，隐藏自身</p>\n<p>service reg</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509100436014.png\" alt=\"image-20210509100436014\"></p>\n<p>联网</p>\n<p>命令行参数-in (install)</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509100544205.png\" alt=\"image-20210509100544205\"></p>\n<p>http后门程序</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509100603715.png\" alt=\"image-20210509100603715\"></p>\n<p>双击点完消失：自删除    exp没有特殊行为</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509100714998.png\" alt=\"image-20210509100714998\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509100810796.png\" alt=\"image-20210509100810796\"></p>\n<p>procmon只看进程监控：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509100918454.png\" alt=\"image-20210509100918454\"></p>\n<p>cmd 删除self</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509100957942.png\" alt=\"image-20210509100957942\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509101140275.png\" alt=\"image-20210509101140275\"></p>\n<p>还是消失，无法有效安装，until第9章RE逆向分析原因！</p>\n<h1 id=\"5-IDA-Pro\"><a href=\"#5-IDA-Pro\" class=\"headerlink\" title=\"5 IDA Pro\"></a>5 IDA Pro</h1><p>5-1 </p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509102224271.png\" alt=\"image-20210509102224271\"></p>\n<p>space</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509102107103.png\" alt=\"image-20210509102107103\"></p>\n<p>1.DllMain地址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509102205330.png\" alt=\"image-20210509102205330\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509102422290.png\" alt=\"image-20210509102422290\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509102450597.png\" alt=\"image-20210509102450597\"></p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>ctrl+X: xref</p>\n<p>p:call  r:read</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509102604985.png\" alt=\"image-20210509102604985\"></p>\n<p>9个p，5个函数调用</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509102732082.png\" alt=\"image-20210509102732082\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>ctrl+G:0x10001757</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509102914334.png\" alt=\"image-20210509102914334\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509103036830.png\" alt=\"image-20210509103036830\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509103203335.png\" alt=\"image-20210509103203335\"></p>\n<p>”[This is RDO]“ 字符串长0Dh~</p>\n<p>esc返回</p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p>23个局部变量</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509103425659.png\" alt=\"image-20210509103425659\"></p>\n<p>6.+的是参数，1个参</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509103507419.png\" alt=\"image-20210509103507419\"></p>\n<ol start=\"7\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509103622480.png\" alt=\"image-20210509103622480\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509103654501.png\" alt=\"image-20210509103654501\"></p>\n<ol start=\"8\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509103734797.png\" alt=\"image-20210509103734797\"></p>\n<p>引用处：向上</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509103807624.png\" alt=\"image-20210509103807624\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509103848442.png\" alt=\"image-20210509103848442\"></p>\n<p>esc</p>\n<p>向下</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509103936843.png\" alt=\"image-20210509103936843\"></p>\n<p>str_cmp</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509104004820.png\" alt=\"image-20210509104004820\"></p>\n<p>开启了远程shell会话</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509104141956.png\" alt=\"image-20210509104141956\"></p>\n<ol start=\"9\">\n<li>global var：sys版本信息</li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509110230490.png\" alt=\"image-20210509110230490\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509110300724.png\" alt=\"image-20210509110300724\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509110323424.png\" alt=\"image-20210509110323424\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509110346929.png\" alt=\"image-20210509110346929\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509110513301.png\" alt=\"image-20210509110513301\"></p>\n<p>10</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509110659598.png\" alt=\"image-20210509110659598\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509110746987.png\" alt=\"image-20210509110746987\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509110822505.png\" alt=\"image-20210509110822505\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509110846261.png\" alt=\"image-20210509110846261\"></p>\n<p>malloc</p>\n<p>send</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509110932828.png\" alt=\"image-20210509110932828\"></p>\n<ol start=\"11\">\n<li></li>\n</ol>\n<p>view-exports：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509111029667.png\" alt=\"image-20210509111029667\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509111056204.png\" alt=\"image-20210509111056204\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509111220140.png\" alt=\"image-20210509111220140\"></p>\n<p>msdn</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509111137417.png\" alt=\"image-20210509111137417\"></p>\n<p>esc</p>\n<p>左分支call：入</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509111322799.png\" alt=\"image-20210509111322799\"></p>\n<p>get进程&#x2F;线程&#x2F;模块列表</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509111444013.png\" alt=\"image-20210509111444013\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509111501921.png\" alt=\"image-20210509111501921\"></p>\n<p>esc</p>\n<p>右分支call：入  same</p>\n<p><strong>PSLIST：发送走所有进程 &#x2F; 匹配某特定进程名并发送走</strong></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510170515227.png\" alt=\"image-20210510170515227\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509111731782.png\" alt=\"image-20210509111731782\"></p>\n<h2 id=\"！！！12\"><a href=\"#！！！12\" class=\"headerlink\" title=\"！！！12.\"></a>！！！12.</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509111906918.png\" alt=\"image-20210509111906918\"></p>\n<p>函数图模式：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509111924816.png\" alt=\"image-20210509111924816\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509112135637.png\" alt=\"image-20210509112135637\"></p>\n<p>改名：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509112210371.png\" alt=\"image-20210509112210371\"></p>\n<p>13</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509112423555.png\" alt=\"image-20210509112423555\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509112527612.png\" alt=\"image-20210509112527612\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509112638284.png\" alt=\"image-20210509112638284\"></p>\n<ol start=\"14\">\n<li></li>\n</ol>\n<p>G</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509112744716.png\" alt=\"image-20210509112744716\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509112818765.png\" alt=\"image-20210509112818765\"></p>\n<p>ascii to int,30*[3e8h&#x3D;&#x3D;1000dec]&#x3D;3w (ms) </p>\n<p>sleep30s</p>\n<p>15</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113341780.png\" alt=\"image-20210509113341780\"></p>\n<p>16</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113512801.png\" alt=\"image-20210509113512801\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113545533.png\" alt=\"image-20210509113545533\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113601564.png\" alt=\"image-20210509113601564\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113621830.png\" alt=\"image-20210509113621830\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113649956.png\" alt=\"image-20210509113649956\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113714653.png\" alt=\"image-20210509113714653\"></p>\n<p>17</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113751830.png\" alt=\"image-20210509113751830\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113914609.png\" alt=\"image-20210509113914609\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113937073.png\" alt=\"image-20210509113937073\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509113950304.png\" alt=\"image-20210509113950304\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509114026365.png\" alt=\"image-20210509114026365\"></p>\n<p>space  找头部</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509114125206.png\" alt=\"image-20210509114125206\"></p>\n<p>交叉引用</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509114207139.png\" alt=\"image-20210509114207139\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509114315677.png\" alt=\"image-20210509114315677\"></p>\n<p>18 随机数据字节，无可读性</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509114349653.png\" alt=\"image-20210509114349653\"></p>\n<p>【IDA python插件相关】</p>\n<p>19 20 21</p>\n<p>获取光标位置</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509114700796.png\" alt=\"image-20210509114700796\"></p>\n<p>配置python脚本较麻烦，用IDC脚本（类似C语言）！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509115022836.png\" alt=\"image-20210509115022836\"></p>\n<p>Lab05-01.idc</p>\n<p>file-script file: open</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509115147006.png\" alt=\"image-20210509115147006\"></p>\n<p>解密出字符串~</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510170628463.png\" alt=\"image-20210510170628463\"></p>\n<h1 id=\"6-识别汇编中的C代码结构\"><a href=\"#6-识别汇编中的C代码结构\" class=\"headerlink\" title=\"6 识别汇编中的C代码结构\"></a>6 识别汇编中的C代码结构</h1><p>6-1</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509115829694.png\" alt=\"image-20210509115829694\"></p>\n<p>msdn</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509115904189.png\" alt=\"image-20210509115904189\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509115934674.png\" alt=\"image-20210509115934674\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509120133467.png\" alt=\"image-20210509120133467\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509120204185.png\" alt=\"image-20210509120204185\"></p>\n<p>if</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509120259543.png\" alt=\"image-20210509120259543\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509120326792.png\" alt=\"image-20210509120326792\"></p>\n<p>过于复杂，不要陷入细节</p>\n<p>esc返回</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509120516609.png\" alt=\"image-20210509120516609\"></p>\n<p>push info str： 改名printf</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509120618554.png\" alt=\"image-20210509120618554\"></p>\n<p>目的：检测当前网络连接状态</p>\n<p>6-2</p>\n<p>输入解析，网络状态回应</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509121605176.png\" alt=\"image-20210509121605176\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509121637293.png\" alt=\"image-20210509121637293\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509122048598.png\" alt=\"image-20210509122048598\"></p>\n<p>wireshark start, 运行6-2.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509151306919.png\" alt=\"image-20210509151306919\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509151434570.png\" alt=\"image-20210509151434570\"></p>\n<p>IDA：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509151536015.png\" alt=\"image-20210509151536015\"></p>\n<ol>\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509151559030.png\" alt=\"image-20210509151559030\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509151639452.png\" alt=\"image-20210509151639452\"></p>\n<p>2.rename：printf</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509151852718.png\" alt=\"image-20210509151852718\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509151925289.png\" alt=\"image-20210509151925289\"></p>\n<p>3.4.</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509152034828.png\" alt=\"image-20210509152034828\"></p>\n<p>5.网络特征</p>\n<p>从wininet.dll 导入的API：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509152237250.png\" alt=\"image-20210509152237250\"></p>\n<p>user agent</p>\n<p>url</p>\n<p>hFile句柄，用它访问url</p>\n<p>读取内容：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509152558578.png\" alt=\"image-20210509152558578\"></p>\n<p>快捷键r  转换含义</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509152637541.png\" alt=\"image-20210509152637541\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509152736967.png\" alt=\"image-20210509152736967\"></p>\n<p>首4B是不是’&lt;!–’ ： html注释开始处</p>\n<p>200h&#x3D;512B</p>\n<p>ctrl+K</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509153039030.png\" alt=\"image-20210509153039030\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509153050449.png\" alt=\"image-20210509153050449\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509153103805.png\" alt=\"image-20210509153103805\"></p>\n<p>esc</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509153147184.png\" alt=\"image-20210509153147184\"></p>\n<p>esc</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509153351141.png\" alt=\"image-20210509153351141\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509153423426.png\" alt=\"image-20210509153423426\"></p>\n<p>sleep 60s ， retn</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509153457530.png\" alt=\"image-20210509153457530\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509154601479.png\" alt=\"image-20210509154601479\"></p>\n<p>6-3</p>\n<p>autorun自启动</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509154713855.png\" alt=\"image-20210509154713855\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509154807564.png\" alt=\"image-20210509154807564\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509154817590.png\" alt=\"image-20210509154817590\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509154839291.png\" alt=\"image-20210509154839291\"></p>\n<ol>\n<li>401130</li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509155037019.png\" alt=\"image-20210509155037019\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>程序名</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509155102141.png\" alt=\"image-20210509155102141\"></p>\n<p>上一个lab中’&lt;!–‘后的第5B字符：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509155200144.png\" alt=\"image-20210509155200144\"></p>\n<ol start=\"3\">\n<li>switch结构</li>\n</ol>\n<p>上一个lab中’&lt;!–‘后的第5B字符</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509155526551.png\" alt=\"image-20210509155526551\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509155615233.png\" alt=\"image-20210509155615233\"></p>\n<p>*4：32位sys里每个内存地址长4B        抵达相应内存地址执行</p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>5+1default(&gt;4)</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509155946455.png\" alt=\"image-20210509155946455\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509160032496.png\" alt=\"image-20210509160032496\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509160125391.png\" alt=\"image-20210509160125391\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509160140549.png\" alt=\"image-20210509160140549\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509160151004.png\" alt=\"image-20210509160151004\"></p>\n<p>5.本地特征：reg自启动项</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509160302557.png\" alt=\"image-20210509160302557\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509160333592.png\" alt=\"image-20210509160333592\"></p>\n<p>deault ：printf  error_str</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509160358594.png\" alt=\"image-20210509160358594\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509160414697.png\" alt=\"image-20210509160414697\"></p>\n<img src=\"http://cache.itzy8.top/《恶意代码分析实战》实验/image-20210509160627839.png\" alt=\"image-20210509160627839\" style=\"zoom:200%;\" />\n\n\n\n\n\n<p>6-4</p>\n<p>动态生成user agent</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509160831844.png\" alt=\"image-20210509160831844\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509160853997.png\" alt=\"image-20210509160853997\"></p>\n<p>add  for循环结构</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509161010138.png\" alt=\"image-20210509161010138\"></p>\n<p>头counter&#x3D;0  &lt;1440: loop</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509161103564.png\" alt=\"image-20210509161103564\"></p>\n<p>尾 cnt自增1</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509161233416.png\" alt=\"image-20210509161233416\"></p>\n<ol start=\"3\">\n<li>解析html：cnt做参</li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509161445776.png\" alt=\"image-20210509161445776\"></p>\n<p>5.动态user agent，  攻击者可得知恶意程序运行了多久：%d min</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509161615446.png\" alt=\"image-20210509161615446\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>总运行时长1min*1440cnt&#x3D;1440min&#x3D;24h</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509161908513.png\" alt=\"image-20210509161908513\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509162155748.png\" alt=\"image-20210509162155748\"></p>\n<h1 id=\"7-分析恶意windows程序\"><a href=\"#7-分析恶意windows程序\" class=\"headerlink\" title=\"7 分析恶意windows程序\"></a>7 分析恶意windows程序</h1><p>7-1</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509164609736.png\" alt=\"image-20210509164609736\"></p>\n<p>服务 联网</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509162420286.png\" alt=\"image-20210509162420286\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509162429694.png\" alt=\"image-20210509162429694\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509162534294.png\" alt=\"image-20210509162534294\"></p>\n<p>2.互斥量：单例运行</p>\n<p>3.主机特征：“HGL345”  “Malservice”</p>\n<p>GetCurrentProcess：获取当前进程的<strong>伪句柄： 可以被复制，但不能被继承， 不用close handle！</strong>！！！！！！！！！！！！！！！！！！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509162711880.png\" alt=\"image-20210509162711880\"></p>\n<p>GetModuleFileNameA:获取完整路径</p>\n<p>1.被用来创建服务</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509163514415.png\" alt=\"image-20210509163514415\"></p>\n<p>type 2：service auto start</p>\n<p>10h:srv win32 own process 该服务运行于独立进程中</p>\n<p>服务名：“Malservice”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509163729348.png\" alt=\"image-20210509163729348\"></p>\n<p>00:00  1.1.2100年</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509163933491.png\" alt=\"image-20210509163933491\"></p>\n<p>等待时间DueTime</p>\n<p>等到00:00  1.1.2100年 才继续执行<br>loop20次</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509164214160.png\" alt=\"image-20210509164214160\"></p>\n<p>创建20个线程不断访问url（dead loop无限循环）：DDos分布式拒绝服务攻击</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509164350436.png\" alt=\"image-20210509164350436\"></p>\n<p>4.网络特征：“IE8.0”  “http…”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509165134857.png\" alt=\"image-20210509165134857\"></p>\n<p>7-2</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509165315338.png\" alt=\"image-20210509165315338\"></p>\n<p>Dependency Walker 输入表分析</p>\n<p>DLE32.dll：COM（component obj model）相关API</p>\n<p>创建COM对象  init close COM库</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509165435074.png\" alt=\"image-20210509165435074\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509165556816.png\" alt=\"image-20210509165556816\"></p>\n<p>run</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509165625072.png\" alt=\"image-20210509165625072\"></p>\n<p>IDA</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509170909840.png\" alt=\"image-20210509170909840\"></p>\n<p>接口&#x2F;类 标志符</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509171035827.png\" alt=\"image-20210509171035827\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509171254231.png\" alt=\"image-20210509171254231\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509171622385.png\" alt=\"image-20210509171622385\"></p>\n<p>iwebbrowser2</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509171642103.png\" alt=\"image-20210509171642103\"></p>\n<p>edx: COM对象ppv的基址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509171848719.png\" alt=\"image-20210509171848719\"></p>\n<p>view-structure：按insert</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509172016990.png\" alt=\"image-20210509172016990\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509172049044.png\" alt=\"image-20210509172049044\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509172150390.png\" alt=\"image-20210509172150390\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509172216230.png\" alt=\"image-20210509172216230\"></p>\n<p>启动IE，访问web地址ad.html 一次性广告</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509172352309.png\" alt=\"image-20210509172352309\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509172642724.png\" alt=\"image-20210509172642724\"></p>\n<h2 id=\"7-3-感染型\"><a href=\"#7-3-感染型\" class=\"headerlink\" title=\"7-3 感染型\"></a>7-3 感染型</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509173539350.png\" alt=\"image-20210509173539350\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509174808013.png\" alt=\"image-20210509174808013\"></p>\n<p>没有LoadLibrary, getProcAddr  没用dll？</p>\n<p>dll:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509174937667.png\" alt=\"image-20210509174937667\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509175008727.png\" alt=\"image-20210509175008727\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509175041587.png\" alt=\"image-20210509175041587\"></p>\n<p>DLL无导出函数？</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509175117493.png\" alt=\"image-20210509175117493\"></p>\n<p>IDA：dll</p>\n<p>结构复杂，只看call</p>\n<p>收发数据：从远程接受命令</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509175341077.png\" alt=\"image-20210509175341077\"></p>\n<p>port：80</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509175538091.png\" alt=\"image-20210509175538091\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509175619999.png\" alt=\"image-20210509175619999\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509175654487.png\" alt=\"image-20210509175654487\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509175811020.png\" alt=\"image-20210509175811020\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509175935080.png\" alt=\"image-20210509175935080\"></p>\n<p>exe：</p>\n<p>main要有2个参argc</p>\n<p>argv：1参exe，2参“。。。”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509180324785.png\" alt=\"image-20210509180324785\"></p>\n<p>judge 2参&#x3D;&#x3D;“。。。。。”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509180422225.png\" alt=\"image-20210509180422225\"></p>\n<p>kernel32.dll 和 7-3.dll映射入内存</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509180543243.png\" alt=\"image-20210509180543243\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509180625472.png\" alt=\"image-20210509180625472\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509180714779.png\" alt=\"image-20210509180714779\"></p>\n<p>跳过。。。</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509180854373.png\" alt=\"image-20210509180854373\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509180926368.png\" alt=\"image-20210509180926368\"></p>\n<p>malloc</p>\n<p>_stricmp</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509181012220.png\" alt=\"image-20210509181012220\"></p>\n<p>搜索，找到C盘下的exe，调用4010A0</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509181114288.png\" alt=\"image-20210509181114288\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509181215363.png\" alt=\"image-20210509181215363\"></p>\n<p>IsBadReadPtr：进程是否有权限访问内存块</p>\n<p>repne&#x3D;&#x3D;strlen</p>\n<p>rep&#x3D;&#x3D;memcpy</p>\n<p>esi–w覆盖–&gt;edi</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509181518299.png\" alt=\"image-20210509181518299\"></p>\n<p>403010 A键转换：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509181556360.png\" alt=\"image-20210509181556360\"></p>\n<p>是1不是L</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509181610503.png\" alt=\"image-20210509181610503\"></p>\n<p>总结：查找C盘<strong>所有exe</strong>，将导入表中的kernel32.dll改为kerne132.dll ！！！！！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509182022482.png\" alt=\"image-20210509182022482\"></p>\n<p>只留文件操作</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509182051277.png\" alt=\"image-20210509182051277\"></p>\n<p>双击，无有用信息<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509182151726.png\" alt=\"image-20210509182151726\"></p>\n<p>cmd 带参</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509182243533.png\" alt=\"image-20210509182243533\"></p>\n<p>C:\\strings.exe—&gt;Dependency walker: 发现已被感染</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509182440674.png\" alt=\"image-20210509182440674\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509182520444.png\" alt=\"image-20210509182520444\"></p>\n<p>假的dll多了很多<strong>导出函数</strong>：将真的dll函数<strong>重定向，实现相同功能</strong>，再add自己的后门功能</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509182747790.png\" alt=\"image-20210509182747790\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509183057744.png\" alt=\"image-20210509183057744\"></p>\n<p>逆程序，将所有exe导入表中kerne132- 改回-&gt;kernel32</p>\n<h1 id=\"9-OD-动态分析\"><a href=\"#9-OD-动态分析\" class=\"headerlink\" title=\"9 OD 动态分析\"></a>9 OD 动态分析</h1><h2 id=\"9-2-？？？逆向shell技术？？？\"><a href=\"#9-2-？？？逆向shell技术？？？\" class=\"headerlink\" title=\"9-2      ？？？逆向shell技术？？？\"></a>9-2      ？？？逆向shell技术？？？</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509183549897.png\" alt=\"image-20210509183549897\"></p>\n<p>导入函数</p>\n<p>cmd执行…</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509183645812.png\" alt=\"image-20210509183645812\"></p>\n<p>proexp监控  , run 9-2.exe：没什么。。。</p>\n<p>OD</p>\n<p>IDA</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509213940397.png\" alt=\"image-20210509213940397\"></p>\n<p>401128  main</p>\n<p>OD bp 401128</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214022245.png\" alt=\"image-20210509214022245\"></p>\n<p>r:转换</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214140535.png\" alt=\"image-20210509214140535\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214213338.png\" alt=\"image-20210509214213338\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214302452.png\" alt=\"image-20210509214302452\"></p>\n<p>PathBuffer</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214355883.png\" alt=\"image-20210509214355883\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214412060.png\" alt=\"image-20210509214412060\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214508856.png\" alt=\"image-20210509214508856\"></p>\n<p>OD缺乏符号支持–&gt;IDA</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214610709.png\" alt=\"image-20210509214610709\"></p>\n<p>获取当前file name</p>\n<p>step over</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214733685.png\" alt=\"image-20210509214733685\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214810767.png\" alt=\"image-20210509214810767\"></p>\n<p>_strcmp:     !&#x3D;  eax&#x3D;1</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214849244.png\" alt=\"image-20210509214849244\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509214953699.png\" alt=\"image-20210509214953699\"></p>\n<p>所以双击end</p>\n<ol start=\"3\">\n<li>重命名为ocl.exe!!!!!!!!!!!!!!</li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509215035470.png\" alt=\"image-20210509215035470\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509215122105.png\" alt=\"image-20210509215122105\"></p>\n<p>40124c！！！</p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509215432247.png\" alt=\"image-20210509215432247\"></p>\n<p>F4， data窗口跟随</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509215531018.png\" alt=\"image-20210509215531018\"></p>\n<p>into 401089</p>\n<p>F5：汇编to C</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509215742163.png\" alt=\"image-20210509215742163\"></p>\n<p>解密过程！401089</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509215844232.png\" alt=\"image-20210509215844232\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509215933111.png\" alt=\"image-20210509215933111\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509215958364.png\" alt=\"image-20210509215958364\"></p>\n<p>getIP失败：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509220049204.png\" alt=\"image-20210509220049204\"></p>\n<p>getIP成功：</p>\n<p>host to net字节序</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509220225547.png\" alt=\"image-20210509220225547\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509220351441.png\" alt=\"image-20210509220351441\"></p>\n<p>6.域名就是：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509215958364.png\" alt=\"image-20210509215958364\"></p>\n<ol start=\"7\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509220447118.png\" alt=\"image-20210509220447118\"></p>\n<p>混淆域名的编码函数：这些str 与 IP xor</p>\n<ol start=\"8\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509220755203.png\" alt=\"image-20210509220755203\"></p>\n<p>into 401000</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509221147382.png\" alt=\"image-20210509221147382\"></p>\n<p>功能：反向shell：向远程发送shell命令</p>\n<p>IO Err-&gt;socket</p>\n<p>绑定了套接字和cmd.exe的标准流: socket data&lt;—to—&gt;cmd.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509221411949.png\" alt=\"image-20210509221411949\"></p>\n<p><strong>？？？？？逆向shell技术？？？？？？？</strong></p>\n<h2 id=\"9-3\"><a href=\"#9-3\" class=\"headerlink\" title=\"9-3\"></a>9-3</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509222319308.png\" alt=\"image-20210509222319308\"></p>\n<ol>\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509221921699.png\" alt=\"image-20210509221921699\"></p>\n<p>运行时动态加载dll：需要LoadLibrary</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509222023371.png\" alt=\"image-20210509222023371\"></p>\n<p>ctrl+X</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509222044819.png\" alt=\"image-20210509222044819\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509222138683.png\" alt=\"image-20210509222138683\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509222154902.png\" alt=\"image-20210509222154902\"></p>\n<p>4+2&#x3D;6个DLL</p>\n<p>2.基地址</p>\n<p>PEiD：DLL1 子系统</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509222412460.png\" alt=\"image-20210509222412460\"></p>\n<p>23同上</p>\n<ol start=\"3\">\n<li>OD</li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509222554875.png\" alt=\"image-20210509222554875\"></p>\n<p>DLL3:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509222652265.png\" alt=\"image-20210509222652265\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509222728522.png\" alt=\"image-20210509222728522\"></p>\n<p>M窗口：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509222758091.png\" alt=\"image-20210509222758091\"></p>\n<ol start=\"4\">\n<li><p>​          7.（1）DLL1的神秘数据：PID</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509223349129.png\" alt=\"image-20210509223349129\"></p>\n</li>\n</ol>\n<p>new IDA：DLL1.dll</p>\n<p>printf</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509223011978.png\" alt=\"image-20210509223011978\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509223051821.png\" alt=\"image-20210509223051821\"></p>\n<p>2参：cur进程PID</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509223134468.png\" alt=\"image-20210509223134468\"></p>\n<p>DLL2Print</p>\n<p>xref</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509223800321.png\" alt=\"image-20210509223800321\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509223839060.png\" alt=\"image-20210509223839060\"></p>\n<p>1000B078保存了“temp.txt”的句柄</p>\n<p>7.（2）DLL2的神秘数据：“temp.txt”的文件句柄</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509223943614.png\" alt=\"image-20210509223943614\"></p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p>new IDA：DLL2.dll</p>\n<p>DLL2ReturnJ：“temp.txt”的文件句柄</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509224104922.png\" alt=\"image-20210509224104922\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509223656867.png\" alt=\"image-20210509223656867\"></p>\n<p>WriteFile写入的是“temp.txt”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509224323624.png\" alt=\"image-20210509224323624\"></p>\n<h3 id=\"6\"><a href=\"#6\" class=\"headerlink\" title=\"6.\"></a>6.</h3><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509224731850.png\" alt=\"image-20210509224731850\"></p>\n<p>msdn</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509224456850.png\" alt=\"image-20210509224456850\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509224528425.png\" alt=\"image-20210509224528425\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509224547379.png\" alt=\"image-20210509224547379\"></p>\n<p>IDA:DLL3.dll</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509224810565.png\" alt=\"image-20210509224810565\"></p>\n<p>xref</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509224905663.png\" alt=\"image-20210509224905663\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509225003090.png\" alt=\"image-20210509225003090\"></p>\n<p>7.(3) DLL3神秘数据：“ping <a href=\"http://www.malwareanalysisbook.com”的内存地址/\">www.malwareanalysisbook.com”的内存地址</a></p>\n<p>6.NetScheduleJobAdd 2参数据：</p>\n<p>9-3.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509225452805.png\" alt=\"image-20210509225452805\"></p>\n<p>局部变量Buffer</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509225523050.png\" alt=\"image-20210509225523050\"></p>\n<p>DLL3GetStructure(局部变量Buffer的地址)</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509225330819.png\" alt=\"image-20210509225330819\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509225754916.png\" alt=\"image-20210509225754916\"></p>\n<p>AT_INFO：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509225848919.png\" alt=\"image-20210509225848919\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509230012026.png\" alt=\"image-20210509230012026\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509230151470.png\" alt=\"image-20210509230151470\"></p>\n<p>insert   search OK</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509230214445.png\" alt=\"image-20210509230214445\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509230327743.png\" alt=\"image-20210509230327743\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509230346163.png\" alt=\"image-20210509230346163\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509230404824.png\" alt=\"image-20210509230404824\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509230428266.png\" alt=\"image-20210509230428266\"></p>\n<ol start=\"8\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509230839828.png\" alt=\"image-20210509230839828\"></p>\n<p>OD查基址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509231128954.png\" alt=\"image-20210509231128954\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509230949765.png\" alt=\"image-20210509230949765\"></p>\n<p>代码段：391000</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210509231053928.png\" alt=\"image-20210509231053928\"></p>\n<h1 id=\"11-恶意代码行为\"><a href=\"#11-恶意代码行为\" class=\"headerlink\" title=\"11 恶意代码行为\"></a>11 恶意代码行为</h1><h2 id=\"11-1-gina\"><a href=\"#11-1-gina\" class=\"headerlink\" title=\"11-1 gina\"></a>11-1 gina</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>百度：windows gina</p>\n<p>windows定制登录(xp&#x2F;2000&#x2F;2003等,vista&#x2F;win7&#x2F;2008已经使用了另外一种叫做凭证提供程序的方式了）</p>\n<p>GINA英文全名叫做 Graphical Identification and Authentication，是一个图形化的登录认证模块.</p>\n<p>首先让我们看一下windows的登录过程,了解一下GINA在登录环节中的位置</p>\n<p>打开任务管理器,会看到一个叫做winlogon的进程,这个进程在windows做好一些初始化工作后会被启动,并且将一直存在直到系统关闭.</p>\n<p>winlogon是windows负责用户登录、认证之类操作的进程,winlogon启动时回查看注册表中 HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\WInlogon的GinaDll项,</p>\n<p>如果发现设置了这一项,则winlogon将使用GinaDll指定的动态模块,否则的话加载msgina.dll(在系统目录下)。</p>\n<p>当有用户登录、锁屏、关机等SAS事件时,winlogon会探测到,winlogon通过调用GINA模块中导出的函数来完成这些SAS事件的处理。</p></blockquote>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510092853152.png\" alt=\"image-20210510092853152\"></p>\n<p>拦截Gina来窃取用户的登录凭证</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510090614767.png\" alt=\"image-20210510090614767\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510092032357.png\" alt=\"image-20210510092032357\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510092042992.png\" alt=\"image-20210510092042992\"></p>\n<p>1.从TGAD资源节中提取msgina32.dll，释放到磁盘:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510092138968.png\" alt=\"image-20210510092138968\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510092225705.png\" alt=\"image-20210510092225705\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510092245226.png\" alt=\"image-20210510092245226\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510092537477.png\" alt=\"image-20210510092537477\"></p>\n<p>2.驻留方式：多了msgina32.dll</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510092713807.png\" alt=\"image-20210510092713807\"></p>\n<p>手动提取&#x3D;&#x3D;自动释放 MD5&#x3D;：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510093303273.png\" alt=\"image-20210510093303273\"></p>\n<p>3.如何窃取用户登录凭证 4.对证书的处理</p>\n<p>gina拦截器：将凭证info给真实msgina.dll，必须包含gina要求的所有导出函数，至少15个</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510093554315.png\" alt=\"image-20210510093554315\"></p>\n<p>str：记录凭证info   .sys值得注意</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510093834351.png\" alt=\"image-20210510093834351\"></p>\n<p>调用原因，判断dll是否被加载时调用</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510094135463.png\" alt=\"image-20210510094135463\"></p>\n<p>获取真实MSGina句柄</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510094400642.png\" alt=\"image-20210510094400642\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510095358685.png\" alt=\"image-20210510095358685\"></p>\n<p>Exports窗口-WlxLoggedOnSAS:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510095600896.png\" alt=\"image-20210510095600896\"></p>\n<p>获取真实dll的”…”函数地址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510095841972.png\" alt=\"image-20210510095841972\"></p>\n<p>Logout有额外操作</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510095951266.png\" alt=\"image-20210510095951266\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510100014185.png\" alt=\"image-20210510100014185\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510100122809.png\" alt=\"image-20210510100122809\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510100445483.png\" alt=\"image-20210510100445483\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510100728491.png\" alt=\"image-20210510100728491\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510100849837.png\" alt=\"image-20210510100849837\"></p>\n<h2 id=\"11-2-inline-hook-邮件addr\"><a href=\"#11-2-inline-hook-邮件addr\" class=\"headerlink\" title=\"11-2 inline hook , 邮件addr\"></a>11-2 inline hook , 邮件addr</h2><p>邮件客户端</p>\n<p>联网</p>\n<p>reg</p>\n<p>ini配置文件</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510101348644.png\" alt=\"image-20210510101348644\"></p>\n<p>对邮件做了处理：SMTP指令RCPT 用来创建email收件人</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510101626429.png\" alt=\"image-20210510101626429\"></p>\n<p>ini被加密了</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510101822776.png\" alt=\"image-20210510101822776\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510101846010.png\" alt=\"image-20210510101846010\"></p>\n<ol>\n<li></li>\n</ol>\n<p>导出函数</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510101914001.png\" alt=\"image-20210510101914001\"></p>\n<p>给cur进线程拍快照</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510102005911.png\" alt=\"image-20210510102005911\"></p>\n<p>adv-reg</p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>监视宿主</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510102340262.png\" alt=\"image-20210510102340262\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510102542044.png\" alt=\"image-20210510102542044\"></p>\n<p>文件：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510102650789.png\" alt=\"image-20210510102650789\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510102822802.png\" alt=\"image-20210510102822802\"></p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510102856693.png\" alt=\"image-20210510102856693\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>reg：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510103133138.png\" alt=\"image-20210510103133138\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510103201321.png\" alt=\"image-20210510103201321\"></p>\n<p>驻留：使该dll加载到所有加载user32.dll的exe中</p>\n<p>regedit</p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p>ini拷贝到C:\\WINDOWS\\system32</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510104530089.png\" alt=\"image-20210510104530089\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510104619583.png\" alt=\"image-20210510104619583\"></p>\n<p>rename   reg</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510104712209.png\" alt=\"image-20210510104712209\"></p>\n<p>DllMain:</p>\n<p>1000105B</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510104941043.png\" alt=\"image-20210510104941043\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510104924286.png\" alt=\"image-20210510104924286\"></p>\n<p>8.ini意义：加密的恶意代码作者邮箱</p>\n<p>打开ini：</p>\n<p>ini读入buffer，&gt;0B,rename解码:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510105542263.png\" alt=\"image-20210510105542263\"></p>\n<p>sys32:ini, spoolvxx32.dll 存入\\system32:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510105726267.png\" alt=\"image-20210510105726267\"></p>\n<p>dll入OD：</p>\n<p>bp 100016CA  (F2)  解码函数</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510105931582.png\" alt=\"image-20210510105931582\"></p>\n<p>单步,</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510110214678.png\" alt=\"image-20210510110214678\"></p>\n<p>rename邮箱：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510110340738.png\" alt=\"image-20210510110340738\"></p>\n<p>安装inline hook</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510110518270.png\" alt=\"image-20210510110518270\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510110649296.png\" alt=\"image-20210510110649296\"></p>\n<p>inline hook原理</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510110826273.png\" alt=\"image-20210510110826273\"></p>\n<p>into 100014B6：</p>\n<p>加载dll的getCurProc</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510110928250.png\" alt=\"image-20210510110928250\"></p>\n<p>proc绝对路径</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510111326100.png\" alt=\"image-20210510111326100\"></p>\n<p>返回arg4：路径名</p>\n<p>esc</p>\n<p>10001104:获取路径中进程名</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510111735559.png\" alt=\"image-20210510111735559\"></p>\n<p>1000102D</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510111920365.png\" alt=\"image-20210510111920365\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510111947855.png\" alt=\"image-20210510111947855\"></p>\n<p>esc</p>\n<p>挨个比较</p>\n<ol start=\"7\">\n<li>所针对的3个攻击目标进程：<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510112019658.png\" alt=\"image-20210510112019658\"></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510112100427.png\" alt=\"image-20210510112100427\"></p>\n<p>cur PID</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510112148808.png\" alt=\"image-20210510112148808\"></p>\n<p>into</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510112234083.png\" alt=\"image-20210510112234083\"></p>\n<p>Thread32First&#x2F;Next 遍历cur thread</p>\n<p>不是curThreadId获取的线程,就挂起</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510112449443.png\" alt=\"image-20210510112449443\"></p>\n<p>rename挂起线程！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510112533483.png\" alt=\"image-20210510112533483\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510112611377.png\" alt=\"image-20210510112611377\"></p>\n<p>1499: curPID,curTID,快照，遍历Th，不是cur 就ResumeThread</p>\n<p>挂起、恢复</p>\n<p>目的：修改内核，安装inline hook</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510113205127.png\" alt=\"image-20210510113205127\"></p>\n<p>into 12A3</p>\n<p>获取wsock32.dll的句柄，得到send函数地址lpaddr</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510113312668.png\" alt=\"image-20210510113312668\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510113624863.png\" alt=\"image-20210510113624863\"></p>\n<p>into 1203</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510114003628.png\" alt=\"image-20210510114003628\"></p>\n<p>[lpaddr]send函数头：0E9h+4Boffset(arg4-lpaddr)</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510114149725.png\" alt=\"image-20210510114149725\"></p>\n<p><strong>在构造jmp指令</strong></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510114407086.png\" alt=\"image-20210510114407086\"></p>\n<p>5Bjmp：E9 offset(4B)</p>\n<p>7Bjmp：mov eax,offset      </p>\n<p>​                jmp eax</p>\n<p>jmp to—&gt;</p>\n<p>3参 func:113D    rename为hook func</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510114842563.png\" alt=\"image-20210510114842563\"></p>\n<p>esc</p>\n<p>1203：钩子安装处</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510115019358.png\" alt=\"image-20210510115019358\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510151618877.png\" alt=\"image-20210510151618877\"></p>\n<p>VirtualProtect改mem权限：改send函数执行权            ， 恢复权限</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510115117047.png\" alt=\"image-20210510115117047\"></p>\n<p>备份send开头处（要改）5B</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510115537984.png\" alt=\"image-20210510115537984\"></p>\n<p>run恶意代码后jmp回send函数处继续执行</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510115710871.png\" alt=\"image-20210510115710871\"></p>\n<p>arg8: 3484的数据空间（4参）</p>\n<ol start=\"6\">\n<li></li>\n</ol>\n<p>into 156B:hook func</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510115823428.png\" alt=\"image-20210510115823428\"></p>\n<p>查找“RCPT TO:”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510115911869.png\" alt=\"image-20210510115911869\"></p>\n<p>add 向外发送的恶意邮件账户</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510120016171.png\" alt=\"image-20210510120016171\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510120056893.png\" alt=\"image-20210510120056893\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510120119056.png\" alt=\"image-20210510120119056\"></p>\n<p>OD文件 附加msimn</p>\n<p>M窗口</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510120215978.png\" alt=\"image-20210510120215978\"></p>\n<p>spoolvxx已载入内存！！！</p>\n<p>ctrl+G:  send</p>\n<p>send已被hook：跳到spoolvxx执行恶意动作</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510120341602.png\" alt=\"image-20210510120341602\"></p>\n<ol start=\"9\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510121312290.png\" alt=\"image-20210510121312290\"></p>\n<p>邮件属于TCP</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510121335540.png\" alt=\"image-20210510121335540\"></p>\n<p>start监控</p>\n<p>outlook</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510121423878.png\" alt=\"image-20210510121423878\"></p>\n<p>SMTP右键follow TCP stream</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510121512073.png\" alt=\"image-20210510121512073\"></p>\n<p>多了个接收地址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510121535926.png\" alt=\"image-20210510121535926\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510150632298.png\" alt=\"image-20210510150632298\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510150704628.png\" alt=\"image-20210510150704628\"></p>\n<h2 id=\"11-3\"><a href=\"#11-3\" class=\"headerlink\" title=\"11-3\"></a>11-3</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510150458655.png\" alt=\"image-20210510150458655\"></p>\n<p>1.2.</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510152610064.png\" alt=\"image-20210510152610064\"></p>\n<p>索引服务，检测mem state, 防止mem过低</p>\n<p>dll:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510152628507.png\" alt=\"image-20210510152628507\"></p>\n<p>dependency walker</p>\n<p>dll导出函数奇怪</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510152720879.png\" alt=\"image-20210510152720879\"></p>\n<p>键盘记录器</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510152740214.png\" alt=\"image-20210510152740214\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510152815859.png\" alt=\"image-20210510152815859\"></p>\n<p>运行</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510153014275.png\" alt=\"image-20210510153014275\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510153052180.png\" alt=\"image-20210510153052180\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510153120025.png\" alt=\"image-20210510153120025\"></p>\n<p>3.4.</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510153209241.png\" alt=\"image-20210510153209241\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510153505045.png\" alt=\"image-20210510153505045\"></p>\n<p>401070</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510153556281.png\" alt=\"image-20210510153556281\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510153719127.png\" alt=\"image-20210510153719127\"></p>\n<p>对cisvc任何修改都W入磁盘</p>\n<p>不用writefile来改写exe了</p>\n<p>40127C【F5】:memcpy</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154012900.png\" alt=\"image-20210510154012900\"></p>\n<p>shellcode</p>\n<p>【C】转为代码</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154132488.png\" alt=\"image-20210510154132488\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154155900.png\" alt=\"image-20210510154155900\"></p>\n<p>Ultra Compare比较cisvc感染前后变化：shellcode!!!!!</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154412466.png\" alt=\"image-20210510154412466\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154440005.png\" alt=\"image-20210510154440005\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154456956.png\" alt=\"image-20210510154456956\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154335885.png\" alt=\"image-20210510154335885\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154545654.png\" alt=\"image-20210510154545654\"></p>\n<p>OEP变为shellcode处</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154607602.png\" alt=\"image-20210510154607602\"></p>\n<p>感染后IDA：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154716328.png\" alt=\"image-20210510154716328\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510154740725.png\" alt=\"image-20210510154740725\"></p>\n<p>OD感染后</p>\n<p>G:1001B0A  F2(bp)</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510155102210.png\" alt=\"image-20210510155102210\"></p>\n<p>1001B1B：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510155310253.png\" alt=\"image-20210510155310253\"></p>\n<p>调用导出函数</p>\n<p>跳到真实OEP</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510155333784.png\" alt=\"image-20210510155333784\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510155556065.png\" alt=\"image-20210510155556065\"></p>\n<p>5.6.</p>\n<p>IDA dll：<br><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510155939470.png\" alt=\"image-20210510155939470\"></p>\n<p>建MZ互斥量</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510160021649.png\" alt=\"image-20210510160021649\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510160447675.png\" alt=\"image-20210510160447675\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510161637328.png\" alt=\"image-20210510161637328\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510161651327.png\" alt=\"image-20210510161651327\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510161725747.png\" alt=\"image-20210510161725747\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510161833970.png\" alt=\"image-20210510161833970\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510161622842.png\" alt=\"image-20210510161622842\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510162410387.png\" alt=\"image-20210510162410387\"></p>\n<h1 id=\"12-隐蔽的恶意代码启动\"><a href=\"#12-隐蔽的恶意代码启动\" class=\"headerlink\" title=\"12 隐蔽的恶意代码启动\"></a>12 隐蔽的恶意代码启动</h1><h2 id=\"12-1-DLL注入IE-弹窗\"><a href=\"#12-1-DLL注入IE-弹窗\" class=\"headerlink\" title=\"12-1 DLL注入IE 弹窗\"></a>12-1 DLL注入IE 弹窗</h2><p>进程注入</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510162625631.png\" alt=\"image-20210510162625631\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510162651279.png\" alt=\"image-20210510162651279\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510162716120.png\" alt=\"image-20210510162716120\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510162735500.png\" alt=\"image-20210510162735500\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510162756903.png\" alt=\"image-20210510162756903\"></p>\n<p>run exe(+dll)</p>\n<p>procexp,没什么。。。</p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510163143078.png\" alt=\"image-20210510163143078\"></p>\n<p>【N】：rename</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510163050092.png\" alt=\"image-20210510163050092\"></p>\n<p>获取每个进程对象的PID</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510163236696.png\" alt=\"image-20210510163236696\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510163302458.png\" alt=\"image-20210510163302458\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510163321473.png\" alt=\"image-20210510163321473\"></p>\n<p>是explorer.exe: ret 1</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510163403264.png\" alt=\"image-20210510163403264\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510163442485.png\" alt=\"image-20210510163442485\"></p>\n<p>拿句柄，操纵进程</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510163637483.png\" alt=\"image-20210510163637483\"></p>\n<p>向上找：<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510163711625.png\" alt=\"image-20210510163711625\"></p>\n<p>dll路径写入explorer.exe</p>\n<p>LoadLibraryA函数（参数lab12-01.dll）地址给CreateRemoteThread</p>\n<p>DLL注入：让远程进程explorer.exe创建线程，调用LoadLibraryA强制加载lab12-01.dll</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510163951554.png\" alt=\"image-20210510163951554\"></p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>每分钟弹窗一次</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510164449075.png\" alt=\"image-20210510164449075\"></p>\n<p>法一：重启系统，失效</p>\n<p>法二：procexp重启进程</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510164545251.png\" alt=\"image-20210510164545251\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510164607914.png\" alt=\"image-20210510164607914\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>dll  iDA:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510164825199.png\" alt=\"image-20210510164825199\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510164922821.png\" alt=\"image-20210510164922821\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510164945897.png\" alt=\"image-20210510164945897\"></p>\n<p>运行时间：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510165103442.png\" alt=\"image-20210510165103442\"></p>\n<p>作为标题。。。2min</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510165400832.png\" alt=\"image-20210510165400832\"></p>\n<h2 id=\"12-2-进程替换\"><a href=\"#12-2-进程替换\" class=\"headerlink\" title=\"12-2 进程替换\"></a>12-2 进程替换</h2><p>前：3-3</p>\n<p>IDA exe：import窗口</p>\n<p>CreateProcess</p>\n<p>get&#x2F;setThreadContext</p>\n<p>R&#x2F;WProcessMemory</p>\n<p>LockResource</p>\n<p>SizeofResource</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510171136952.png\" alt=\"image-20210510171136952\"></p>\n<p>CREATE_SUSPEND，等主进程resume thread</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510171225682.png\" alt=\"image-20210510171225682\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510171421018.png\" alt=\"image-20210510171421018\"></p>\n<p>添加context结构体：</p>\n<p>structure窗口【insert】</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510173029630.png\" alt=\"image-20210510173029630\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510173533057.png\" alt=\"image-20210510173533057\"></p>\n<p>引用该进程的ebx寄存器–&gt;指向PEB</p>\n<p>msdn &#x2F; windbg：PEB+8B&#x3D;被挂起进程的imgBaseAddr–[4B]-&gt;入Buffer</p>\n<p>释放新创建的进程内存空间，之后就可填充恶意代码了</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510174130547.png\" alt=\"image-20210510174130547\"></p>\n<p>开始处：比对“MZ”“PE”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510174528501.png\" alt=\"image-20210510174528501\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510174433218.png\" alt=\"image-20210510174433218\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510175020047.png\" alt=\"image-20210510175020047\">“PE”+0x34&#x3D;imagebase</p>\n<p>40h:page_exec_RW</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510175113828.png\" alt=\"image-20210510175113828\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510175906893.png\" alt=\"image-20210510175906893\"></p>\n<p>循环 cnt</p>\n<p>‘PE’+6B：区段数</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510180513771.png\" alt=\"image-20210510180513771\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510180828832.png\" alt=\"image-20210510180828832\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510180942451.png\" alt=\"image-20210510180942451\"></p>\n<p>var4：’MZ‘      +3C&#x3D;’PE‘</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510181029100.png\" alt=\"image-20210510181029100\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510181630637.png\" alt=\"image-20210510181630637\"></p>\n<p>’PE‘+0xF8  [40B&#x3D;28h*【0x6区段数】]</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510181324647.png\" alt=\"image-20210510181324647\"></p>\n<p>在遍历区段头</p>\n<p>加struct</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510181728790.png\" alt=\"image-20210510181728790\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510181744469.png\" alt=\"image-20210510181744469\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510181801122.png\" alt=\"image-20210510181801122\"></p>\n<p>rename：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510181847079.png\" alt=\"image-20210510181847079\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510181927840.png\" alt=\"image-20210510181927840\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510181947255.png\" alt=\"image-20210510181947255\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510182034765.png\" alt=\"image-20210510182034765\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510182101669.png\" alt=\"image-20210510182101669\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510182119863.png\" alt=\"image-20210510182119863\"></p>\n<p>复制节表</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510200503450.png\" alt=\"image-20210510200503450\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510200702584.png\" alt=\"image-20210510200702584\"></p>\n<p>判断来源</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510200847225.png\" alt=\"image-20210510200847225\"></p>\n<p>ctrl+X:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510200942580.png\" alt=\"image-20210510200942580\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510201057809.png\" alt=\"image-20210510201057809\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510201206319.png\" alt=\"image-20210510201206319\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510201413048.png\" alt=\"image-20210510201413048\"></p>\n<p>res…—[4010EA]copy to—-&gt;svchost.exe</p>\n<p>into 40132C：</p>\n<p>find&#x2F;load&#x2F;lock&#x2F;sizeof Resource</p>\n<p>reshacker: res保存为bin</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510201912025.png\" alt=\"image-20210510201912025\"></p>\n<p>code被加密了(^41h)</p>\n<p>40132C函数中：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510202224196.png\" alt=\"image-20210510202224196\"></p>\n<p>into 401000:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510202251600.png\" alt=\"image-20210510202251600\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510202315412.png\" alt=\"image-20210510202315412\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510202412564.png\" alt=\"image-20210510202412564\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510202436022.png\" alt=\"image-20210510202436022\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510202559516.png\" alt=\"image-20210510202559516\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510202703471.png\" alt=\"image-20210510202703471\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510202648897.png\" alt=\"image-20210510202648897\"></p>\n<h2 id=\"12-3-keylogger-Hook\"><a href=\"#12-3-keylogger-Hook\" class=\"headerlink\" title=\"12-3 keylogger  Hook\"></a>12-3 keylogger  Hook</h2><p>IDA:imports</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510203453129.png\" alt=\"image-20210510203453129\"></p>\n<p>Hook类型：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510211053137.png\" alt=\"image-20210510211053137\"></p>\n<p>msdn  0Dh&#x3D;13</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510211122364.png\" alt=\"image-20210510211122364\"></p>\n<p>lpfn：hook函数地址       keylogger</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510211427662.png\" alt=\"image-20210510211427662\"></p>\n<p>into fn:</p>\n<p>401086【Y】：L参-&gt;</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510211652681.png\" alt=\"image-20210510211652681\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510211741299.png\" alt=\"image-20210510211741299\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510211727327.png\" alt=\"image-20210510211727327\"></p>\n<p>判定按键类型：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510211914365.png\" alt=\"image-20210510211914365\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510211839836.png\" alt=\"image-20210510211839836\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510211821878.png\" alt=\"image-20210510211821878\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510212038162.png\" alt=\"image-20210510212038162\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510212057908.png\" alt=\"image-20210510212057908\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510212128368.png\" alt=\"image-20210510212128368\"></p>\n<p>var_C&#x3D;Buffer&#x3D;参&#x3D;vkCode</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510212412706.png\" alt=\"image-20210510212412706\"></p>\n<p>[shift]vkCode&#x3D;10h  -8h&#x3D;8h</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510212506047.png\" alt=\"image-20210510212506047\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510212603619.png\" alt=\"image-20210510212603619\"></p>\n<p>dd: data dw  4B</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510212815501.png\" alt=\"image-20210510212815501\"></p>\n<p>401249:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510212851723.png\" alt=\"image-20210510212851723\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210510212934451.png\" alt=\"image-20210510212934451\"></p>\n<p>SetWindowsHookExA</p>\n<h2 id=\"12-4-sfc-os32-dll-木马化wupd\"><a href=\"#12-4-sfc-os32-dll-木马化wupd\" class=\"headerlink\" title=\"12-4 sfc_os32.dll  木马化wupd\"></a>12-4 sfc_os32.dll  木马化wupd</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511093004487.png\" alt=\"image-20210511093004487\"></p>\n<p>res hacker提取资源  4D5A 5045</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511093053908.png\" alt=\"image-20210511093053908\"></p>\n<p>procmon filter-file：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511093335369.png\" alt=\"image-20210511093335369\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511093413034.png\" alt=\"image-20210511093413034\"></p>\n<p>wireshark</p>\n<p>运行</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511093640789.png\" alt=\"image-20210511093640789\"></p>\n<p>下载updater.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511095109948.png\" alt=\"image-20210511095109948\"></p>\n<p>IDA    rename:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511093858587.png\" alt=\"image-20210511093858587\"></p>\n<ol>\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511094000439.png\" alt=\"image-20210511094000439\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511095036738.png\" alt=\"image-20210511095036738\"></p>\n<p>into 401000:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511094111261.png\" alt=\"image-20210511094111261\"></p>\n<p>【r】转换：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511094300832.png\" alt=\"image-20210511094300832\"></p>\n<p>winlogon.exe</p>\n<notreal>\n\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511094458576.png\" alt=\"image-20210511094458576\"></p>\n<p>get加载到进程的所有模块句柄数组</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511094653555.png\" alt=\"image-20210511094653555\"></p>\n<p>cur模块名 是否&#x3D;&#x3D;winlogon.exe    ret 1&#x2F;0</p>\n<p>esc</p>\n<p>rename: 确定PID是否表示winlogon.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511095456655.png\" alt=\"image-20210511095456655\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>ret 0false:循环再找</p>\n<p>ret 1:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511095529535.png\" alt=\"image-20210511095529535\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511095548418.png\" alt=\"image-20210511095548418\"></p>\n<p>提权</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511095624657.png\" alt=\"image-20210511095624657\"></p>\n<p>esc</p>\n<p>sfc_os.dll中编号2的函数指针</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511095803159.png\" alt=\"image-20210511095803159\"></p>\n<p>dwDesiredAccess&#x3D;1F0FFFh:  PROCESS_ALL_ACCESS</p>\n<p>打开winlogon，get winlogon句柄</p>\n<p>向winlogon远程线程注入sfc_os.dll中编号2的函数:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511100020100.png\" alt=\"image-20210511100020100\"></p>\n<p>不用writeProcessMem了</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511100201697.png\" alt=\"image-20210511100201697\"></p>\n<p>sfc_os.dll：windows文件保护</p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511100333237.png\" alt=\"image-20210511100333237\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511101418803.png\" alt=\"image-20210511101418803\"></p>\n<p><a href=\"https://www.aldeid.com/wiki/WFP-Windows-File-Protection\">https://www.aldeid.com/wiki/WFP-Windows-File-Protection</a></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511101525085.png\" alt=\"image-20210511101525085\"></p>\n<p>4参：SfcTerminateWatcherThread() 函数</p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p>esc</p>\n<p>wupdmgr用于系统更新</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511102041568.png\" alt=\"image-20210511102041568\"></p>\n<p>wupdmgr.exe改名为winup.exe, 复制到&#x2F;temp</p>\n<p>into 4011FC:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511102431252.png\" alt=\"image-20210511102431252\"></p>\n<p>正在提取资源节到硬盘上</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511102548167.png\" alt=\"image-20210511102548167\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511103057976.png\" alt=\"image-20210511103057976\"></p>\n<ol start=\"6\">\n<li></li>\n</ol>\n<p>恶意res 12-4.exe  IDA：<br><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511104416614.png\" alt=\"image-20210511104416614\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511103458599.png\" alt=\"image-20210511103458599\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511103707535.png\" alt=\"image-20210511103707535\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511103653135.png\" alt=\"image-20210511103653135\"></p>\n<p>下载，重命名，自动更新</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511103802030.png\" alt=\"image-20210511103802030\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511104600294.png\" alt=\"image-20210511104600294\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511104626480.png\" alt=\"image-20210511104626480\"></p>\n<h1 id=\"13-数据加密\"><a href=\"#13-数据加密\" class=\"headerlink\" title=\"13 数据加密\"></a>13 数据加密</h1><h2 id=\"13-1\"><a href=\"#13-1\" class=\"headerlink\" title=\"13-1\"></a>13-1</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511110518447.png\" alt=\"image-20210511110518447\"></p>\n<p>wireshark</p>\n<p>运行</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511110631097.png\" alt=\"image-20210511110631097\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511110728914.png\" alt=\"image-20210511110728914\"></p>\n<p>IDA str：没有网址 和 加密str！！！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511110828330.png\" alt=\"image-20210511110828330\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511110936938.png\" alt=\"image-20210511110936938\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511110957650.png\" alt=\"image-20210511110957650\"></p>\n<p>排除清零 和 库代码：只剩4011B8</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511111125705.png\" alt=\"image-20210511111125705\"></p>\n<p>arg4：BufferLen&#x3D;0Ch</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511111411996.png\" alt=\"image-20210511111411996\"></p>\n<p>rename</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511111445323.png\" alt=\"image-20210511111445323\"></p>\n<p>^3Bh</p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>ctrl+X</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511111639173.png\" alt=\"image-20210511111639173\"></p>\n<p>10进制索引值：101</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511111749922.png\" alt=\"image-20210511111749922\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112047207.png\" alt=\"image-20210511112047207\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112119475.png\" alt=\"image-20210511112119475\"></p>\n<p>7060-编辑-修改数据</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112235535.png\" alt=\"image-20210511112235535\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112210704.png\" alt=\"image-20210511112210704\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112305473.png\" alt=\"image-20210511112305473\"></p>\n<p>域名网址ok！</p>\n<p>4.那加密str呢？</p>\n<p>PEiD插件Kanal：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112523817.png\" alt=\"image-20210511112523817\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112558699.png\" alt=\"image-20210511112558699\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112630772.png\" alt=\"image-20210511112630772\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112649498.png\" alt=\"image-20210511112649498\"></p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112818106.png\" alt=\"image-20210511112818106\"></p>\n<p>rename</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112839802.png\" alt=\"image-20210511112839802\"></p>\n<p>‘&#x3D;’做填充字符</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511112904274.png\" alt=\"image-20210511112904274\"></p>\n<p>用标准Base64编码创建get请求的字符串</p>\n<ol start=\"6\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511113035672.png\" alt=\"image-20210511113035672\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511113050248.png\" alt=\"image-20210511113050248\"></p>\n<ol start=\"7\">\n<li></li>\n</ol>\n<p>【F5】</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511113432085.png\" alt=\"image-20210511113432085\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511113459876.png\" alt=\"image-20210511113459876\"></p>\n<p>对【hostname 前12B】 进行Base64编码</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511113654922.png\" alt=\"image-20210511113654922\"></p>\n<p>InternetOpenUrlA</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511113836804.png\" alt=\"image-20210511113836804\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511113858919.png\" alt=\"image-20210511113858919\"></p>\n<ol start=\"8\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511114628760.png\" alt=\"image-20210511114628760\"></p>\n<p>通信信号beacon？？？？</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511114900314.png\" alt=\"image-20210511114900314\"></p>\n<h2 id=\"13-2\"><a href=\"#13-2\" class=\"headerlink\" title=\"13-2\"></a>13-2</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511115108719.png\" alt=\"image-20210511115108719\"></p>\n<p>procmon filter</p>\n<p>运行</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511115334373.png\" alt=\"image-20210511115334373\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511115355352.png\" alt=\"image-20210511115355352\"></p>\n<p>peid-kanal 空！！！</p>\n<p>插件findcrypt.plw放入ida\\plugins中：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511115651007.png\" alt=\"image-20210511115651007\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511115711864.png\" alt=\"image-20210511115711864\"></p>\n<p>search-text: xor ,find all occur</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511115921216.png\" alt=\"image-20210511115921216\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511115934424.png\" alt=\"image-20210511115934424\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511115953694.png\" alt=\"image-20210511115953694\"></p>\n<p>4参 loop  shl shr</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511120143668.png\" alt=\"image-20210511120143668\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511120042931.png\" alt=\"image-20210511120042931\"></p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>加密函数~temp文件</p>\n<p>回溯</p>\n<p>imports-WriteFIle-xref：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511120433670.png\" alt=\"image-20210511120433670\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>createFile  WFile</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511120648277.png\" alt=\"image-20210511120648277\"></p>\n<p>xref</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511120725283.png\" alt=\"image-20210511120725283\"></p>\n<p>获取想要加密的内容</p>\n<p>40181F：加密函数</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511120921366.png\" alt=\"image-20210511120921366\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511121003128.png\" alt=\"image-20210511121003128\"></p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p>401070：获取想要加密的内容</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511121124239.png\" alt=\"image-20210511121124239\"></p>\n<p>BitBlt</p>\n<p>GetDIBits</p>\n<p>获取位图信息，复制到buffer</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511121415130.png\" alt=\"image-20210511121415130\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511121449484.png\" alt=\"image-20210511121449484\"></p>\n<p>6.7.</p>\n<p><strong>手动解密</strong></p>\n<p>非标准 不好识别</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511121551298.png\" alt=\"image-20210511121551298\"></p>\n<p>加密文件-&gt;加密函数：逆运行解密</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511121733905.png\" alt=\"image-20210511121733905\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511121816745.png\" alt=\"image-20210511121816745\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511121847857.png\" alt=\"image-20210511121847857\"></p>\n<p>加密函数处: bp 401880 </p>\n<p>生成temp。。。后: bp 40190A</p>\n<p>[F2]</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511122025705.png\" alt=\"image-20210511122025705\"></p>\n<p>run</p>\n<p>单步，生成一个temp</p>\n<p>run</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511122221822.png\" alt=\"image-20210511122221822\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511122254429.png\" alt=\"image-20210511122254429\"></p>\n<p>选中到底</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511122333078.png\" alt=\"image-20210511122333078\"></p>\n<p>bin粘贴</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511122344364.png\" alt=\"image-20210511122344364\"></p>\n<p>run<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511122434168.png\" alt=\"image-20210511122434168\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511122452736.png\" alt=\"image-20210511122452736\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511122507017.png\" alt=\"image-20210511122507017\"></p>\n<p>原始temp[.bmp] 被加密了。。。</p>\n<p><strong>编程解密</strong></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511122846648.png\" alt=\"image-20210511122846648\"></p>\n<p>拷贝temp，改”\\…”内容</p>\n<img src=\"http://cache.itzy8.top/《恶意代码分析实战》实验/image-20210511122934060.png\" alt=\"image-20210511122934060\" style=\"zoom:200%;\" />\n\n<p>0xC&#x3D;12</p>\n<p>py脚本放入\\PyCommands:</p>\n<p>b space删除断点</p>\n<p>重新载入exe</p>\n<p>！脚本名</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511123241929.png\" alt=\"image-20210511123241929\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511123316462.png\" alt=\"image-20210511123316462\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511123329828.png\" alt=\"image-20210511123329828\"></p>\n<h2 id=\"13-3\"><a href=\"#13-3\" class=\"headerlink\" title=\"13-3\"></a>13-3</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511153236607.png\" alt=\"image-20210511153236607\"></p>\n<ol>\n<li></li>\n</ol>\n<p>wireshark</p>\n<p> DNS www…..</p>\n<p>IDA:</p>\n<p>自定义Base64加密算法</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511153830087.png\" alt=\"image-20210511153830087\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>search-text:  6个xor</p>\n<p>rename：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511154133777.png\" alt=\"image-20210511154133777\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511154152353.png\" alt=\"image-20210511154152353\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511154207735.png\" alt=\"image-20210511154207735\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511154239166.png\" alt=\"image-20210511154239166\"></p>\n<p>插件findcrypt.plw放入ida\\plugins中：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511115651007.png\" alt=\"image-20210511115651007\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511154447781.png\" alt=\"image-20210511154447781\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511115711864.png\" alt=\"image-20210511115711864\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511154526416.png\" alt=\"image-20210511154526416\"></p>\n<p>40cb08: xref   e:encode</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511154631125.png\" alt=\"image-20210511154631125\"></p>\n<p>40DB08: xref       d:decode</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511154725410.png\" alt=\"image-20210511154725410\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511180359493.png\" alt=\"image-20210511180359493\"></p>\n<p>xor6:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511181720589.png\" alt=\"image-20210511181720589\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511181809806.png\" alt=\"image-20210511181809806\"></p>\n<p>xor1:密钥初始化代码</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511181921721.png\" alt=\"image-20210511181921721\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511181950347.png\" alt=\"image-20210511181950347\"></p>\n<p>xref</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511182038204.png\" alt=\"image-20210511182038204\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511182121344.png\" alt=\"image-20210511182121344\"></p>\n<p>xor1：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511182155589.png\" alt=\"image-20210511182155589\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511182222031.png\" alt=\"image-20210511182222031\"></p>\n<p>arg0：密钥</p>\n<p>RFile</p>\n<p>-&gt;-&gt;-&gt;-&gt;<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511182607742.png\" alt=\"image-20210511182607742\"></p>\n<p>WFile</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511153140538.png\" alt=\"image-20210511153140538\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511183003439.png\" alt=\"image-20210511183003439\"></p>\n<p>varBE0+4&#x3D;var54&#x3D;arg10&#x3D;4015B7参</p>\n<p>&#x3D;ebp+S:网络套接字</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511183242845.png\" alt=\"image-20210511183242845\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511185423460.png\" alt=\"image-20210511185423460\"></p>\n<p>py27</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511185552563.png\" alt=\"image-20210511185552563\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511185639848.png\" alt=\"image-20210511185639848\"></p>\n<p>解密AES</p>\n<p>need：VS &#x2F; VCForPython27     pycrypto-2.6.1</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511185754957.png\" alt=\"image-20210511185754957\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511185858786.png\" alt=\"image-20210511185858786\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511190144089.png\" alt=\"image-20210511190144089\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511190233307.png\" alt=\"image-20210511190233307\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511190644100.png\" alt=\"image-20210511190644100\"></p>\n<h1 id=\"14-恶意代码的网络特征\"><a href=\"#14-恶意代码的网络特征\" class=\"headerlink\" title=\"14 恶意代码的网络特征\"></a>14 恶意代码的网络特征</h1><h2 id=\"14-1\"><a href=\"#14-1\" class=\"headerlink\" title=\"14-1\"></a>14-1</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511195914336.png\" alt=\"image-20210511195914336\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511200651840.png\" alt=\"image-20210511200651840\"></p>\n<p>import</p>\n<p>xref*2:</p>\n<p>URLDownloadToCacheFileA</p>\n<p>CreateProcessA</p>\n<p>rename:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511201040452.png\" alt=\"image-20210511201040452\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511201132483.png\" alt=\"image-20210511201132483\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511201654087.png\" alt=\"image-20210511201654087\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511201542590.png\" alt=\"image-20210511201542590\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511201606595.png\" alt=\"image-20210511201606595\"></p>\n<p>xref:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511201758155.png\" alt=\"image-20210511201758155\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511203203388.png\" alt=\"image-20210511203203388\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511203705505.png\" alt=\"image-20210511203705505\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511203855359.png\" alt=\"image-20210511203855359\"></p>\n<p>改为标准填充字符’&#x3D;’</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511203956870.png\" alt=\"image-20210511203956870\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511204810000.png\" alt=\"image-20210511204810000\"></p>\n<ol start=\"8\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511204742784.png\" alt=\"image-20210511204742784\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511205121674.png\" alt=\"image-20210511205121674\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511205728419.png\" alt=\"image-20210511205728419\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511210009022.png\" alt=\"image-20210511210009022\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511205848276.png\" alt=\"image-20210511205848276\"></p>\n<h2 id=\"14-2\"><a href=\"#14-2\" class=\"headerlink\" title=\"14-2\"></a>14-2</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511212153387.png\" alt=\"image-20210511212153387\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511212304759.png\" alt=\"image-20210511212304759\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511212706217.png\" alt=\"image-20210511212706217\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511212625304.png\" alt=\"image-20210511212625304\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511221015234.png\" alt=\"image-20210511221015234\"></p>\n<p>IDA:</p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511213430615.png\" alt=\"image-20210511213430615\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511213442596.png\" alt=\"image-20210511213442596\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511213755116.png\" alt=\"image-20210511213755116\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511220811855.png\" alt=\"image-20210511220811855\"></p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>createThread*2</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511215818400.png\" alt=\"image-20210511215818400\"></p>\n<p>LoadStringA：从资源节里读取字符串</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511220316756.png\" alt=\"image-20210511220316756\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511220557653.png\" alt=\"image-20210511220557653\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511220647232.png\" alt=\"image-20210511220647232\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511220748071.png\" alt=\"image-20210511220748071\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511221132768.png\" alt=\"image-20210511221132768\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>401000 内部函数</p>\n<p>403010 串</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511221433246.png\" alt=\"image-20210511221433246\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511221356053.png\" alt=\"image-20210511221356053\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511221700422.png\" alt=\"image-20210511221700422\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511221755629.png\" alt=\"image-20210511221755629\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511222118344.png\" alt=\"image-20210511222118344\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511222409534.png\" alt=\"image-20210511222409534\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511222608201.png\" alt=\"image-20210511222608201\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511222544906.png\" alt=\"image-20210511222544906\"></p>\n<ol start=\"8\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511222755690.png\" alt=\"image-20210511222755690\"></p>\n<p>esc</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511222852186.png\" alt=\"image-20210511222852186\"></p>\n<p>自删除：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511222931633.png\" alt=\"image-20210511222931633\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511223013600.png\" alt=\"image-20210511223013600\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511223721150.png\" alt=\"image-20210511223721150\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210511223634963.png\" alt=\"image-20210511223634963\"></p>\n<p><strong>Snort规则编写简述。。。</strong></p>\n<h2 id=\"14-3\"><a href=\"#14-3\" class=\"headerlink\" title=\"14-3\"></a>14-3</h2><p>wireshark</p>\n<p>.pcapng 捕获的数据包文件</p>\n<p>IDA：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513175830444.png\" alt=\"image-20210513175830444\"></p>\n<ol>\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513180457763.png\" alt=\"image-20210513180457763\"></p>\n<p>401280 InternetOpenUrlA</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513180551934.png\" alt=\"image-20210513180551934\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>4011F3</p>\n<p>参：source</p>\n<p>​        arg4</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513180730744.png\" alt=\"image-20210513180730744\"></p>\n<p>xref: winmain</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513204946666.png\" alt=\"image-20210513204946666\"></p>\n<p>source–401457:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513205115717.png\" alt=\"image-20210513205115717\"></p>\n<p>createFile失败，反馈给信令网址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513205318081.png\" alt=\"image-20210513205318081\"></p>\n<p>T:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513205355284.png\" alt=\"image-20210513205355284\"></p>\n<p>&#x3D;&#x3D;</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513205439446.png\" alt=\"image-20210513205439446\"></p>\n<p>C:\\autobat.exe是存储URL明文的配置文件</p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>4012C7后 strstr &lt;no   00401000:</p>\n<p>拆分 乱序  隐藏！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513212453147.png\" alt=\"image-20210513212453147\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513212802386.png\" alt=\"image-20210513212802386\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513213803225.png\" alt=\"image-20210513213803225\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513213438548.png\" alt=\"image-20210513213438548\"></p>\n<p>从web页面noscript标签中的某些特定组件 获得命令</p>\n<p>类似例子：注释域？？？？？？？？？？？？？？</p>\n<p>更难区分恶意流量与合法流量</p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>4017D1:call 401684</p>\n<p>1分为2</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513214334538.png\" alt=\"image-20210513214334538\"></p>\n<p>case0: d URLDownloadtoCacheFile  CreateProcA</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513214424787.png\" alt=\"image-20210513214424787\"></p>\n<p>10 n end</p>\n<p>15 s sleep</p>\n<p>14 r  1651 1372 </p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513215357916.png\" alt=\"image-20210513215357916\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513215632268.png\" alt=\"image-20210513215632268\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513175845693.png\" alt=\"image-20210513175845693\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513220442080.png\" alt=\"image-20210513220442080\"></p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p>1565&#x2F;1651–1147：strlen    str idx:byte_4070D8</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513221609313.png\" alt=\"image-20210513221609313\"></p>\n<p>URL 只需小写      2Fh  00–&gt;’&#x2F;‘</p>\n<p>非标准算法，需逆向</p>\n<p>太简单， 输出中   http:&#x2F;&#x2F; 对应编码参数 ‘&#x2F;08202016370000’ 易被识别</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513221124377.png\" alt=\"image-20210513221124377\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513175949187.png\" alt=\"image-20210513175949187\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513175934091.png\" alt=\"image-20210513175934091\"></p>\n<ol start=\"9\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513222551378.png\" alt=\"image-20210513222551378\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210513222749617.png\" alt=\"image-20210513222749617\"></p>\n<img src=\"http://cache.itzy8.top/《恶意代码分析实战》实验/image-20210513224630181.png\" alt=\"image-20210513224630181\" style=\"zoom:150%;\" />\n\n\n\n<h1 id=\"15-对抗反汇编-F5-space-Data、Code、P-func\"><a href=\"#15-对抗反汇编-F5-space-Data、Code、P-func\" class=\"headerlink\" title=\"15 对抗反汇编 F5 space Data、Code、P:func\"></a>15 对抗反汇编 F5 space Data、Code、P:func</h1><h2 id=\"15-1\"><a href=\"#15-1\" class=\"headerlink\" title=\"15-1\"></a>15-1</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514085428466.png\" alt=\"image-20210514085428466\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514093521832.png\" alt=\"image-20210514093521832\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514085614670.png\" alt=\"image-20210514085614670\"></p>\n<p>1.固定条件的跳转指令 永假条件分支技术</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514090910271.png\" alt=\"image-20210514090910271\"></p>\n<p>jmp到call指令中间不正常，地址标红不可用</p>\n<p>401010【D】变data</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514091043347.png\" alt=\"image-20210514091043347\"></p>\n<p>401011【C】变code</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514091120650.png\" alt=\"image-20210514091120650\"></p>\n<p>没对齐</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514091208593.png\" alt=\"image-20210514091208593\"></p>\n<p>【C】</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514091248719.png\" alt=\"image-20210514091248719\"></p>\n<p>【C】直到指令紧挨</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514091324553.png\" alt=\"image-20210514091324553\"></p>\n<ol start=\"2\">\n<li>5次   添加E8，以欺骗它反汇编为call+不可达地址！！！！</li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514091412684.png\" alt=\"image-20210514091412684\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514091455807.png\" alt=\"image-20210514091455807\"></p>\n<p>【D】</p>\n<p>next【C】。。。</p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>main：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>选中。。。retn</strong></p></blockquote>\n<p>【P】强制变为函数</p>\n<p>【SPACE】</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514091902518.png\" alt=\"image-20210514091902518\"></p>\n<p>arg_4： 命令行2参数</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514092010880.png\" alt=\"image-20210514092010880\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514092100808.png\" alt=\"image-20210514092100808\"></p>\n<p><strong>【F5】 to C:</strong></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514092225279.png\" alt=\"image-20210514092225279\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514092249538.png\" alt=\"image-20210514092249538\"></p>\n<h2 id=\"15-2\"><a href=\"#15-2\" class=\"headerlink\" title=\"15-2\"></a>15-2</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514100008089.png\" alt=\"image-20210514100008089\"></p>\n<p>esp永远非零</p>\n<p>D C</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514100102408.png\" alt=\"image-20210514100102408\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514100206755.png\" alt=\"image-20210514100206755\"></p>\n<p>D C CC</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514100250188.png\" alt=\"image-20210514100250188\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514100339931.png\" alt=\"image-20210514100339931\"></p>\n<p>DC</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514100431791.png\" alt=\"image-20210514100431791\"></p>\n<p>DC</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514100638743.png\" alt=\"image-20210514100638743\"></p>\n<p>EE【D】</p>\n<p>EF【C】</p>\n<p>E6【D】</p>\n<p>E8【C】</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514100938585.png\" alt=\"image-20210514100938585\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514101511234.png\" alt=\"image-20210514101511234\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514101627980.png\" alt=\"image-20210514101627980\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514101717204.png\" alt=\"image-20210514101717204\"></p>\n<p>–</p>\n<p>全nop</p>\n<p>–</p>\n<p>选中 P</p>\n<p>space</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514101859580.png\" alt=\"image-20210514101859580\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514102042971.png\" alt=\"image-20210514102042971\"></p>\n<ol>\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514103109062.png\" alt=\"image-20210514103109062\"></p>\n<p>call 401386</p>\n<p>【r】转换str</p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>上</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514103231097.png\" alt=\"image-20210514103231097\"></p>\n<p>user-agent用本地PC名称</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514103157757.png\" alt=\"image-20210514103157757\"></p>\n<p>F5</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514104251929.png\" alt=\"image-20210514104251929\"></p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>openUrl readFile （Buffer） strstr “Bamboo::”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514104448425.png\" alt=\"image-20210514104448425\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514104933697.png\" alt=\"image-20210514104933697\"></p>\n<p>readFile  </p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514111604156.png\" alt=\"image-20210514111604156\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514111642140.png\" alt=\"image-20210514111642140\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514111659947.png\" alt=\"image-20210514111659947\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514111730116.png\" alt=\"image-20210514111730116\"></p>\n<h2 id=\"15-3\"><a href=\"#15-3\" class=\"headerlink\" title=\"15-3\"></a>15-3</h2><p>进程快照  proc32first&#x2F;next  printf</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514112334601.png\" alt=\"image-20210514112334601\"></p>\n<p>OD</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514112630793.png\" alt=\"image-20210514112630793\"></p>\n<p>IDA</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514115051416.png\" alt=\"image-20210514115051416\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514112712733.png\" alt=\"image-20210514112712733\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514112757788.png\" alt=\"image-20210514112757788\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514112811493.png\" alt=\"image-20210514112811493\"></p>\n<p>1.将main的返回地址 覆盖为40148C，继续执行恶意代码</p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>【G】40148C</p>\n<p>‘E9’【D】</p>\n<p>【C】</p>\n<p><strong>自造除零异常处理，跳过printf(只是诱饵)</strong></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514113424570.png\" alt=\"image-20210514113424570\"></p>\n<p>4014C0: data【C】code</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514113737180.png\" alt=\"image-20210514113737180\">？？？？？？？？？？？？</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514113603774.png\" alt=\"image-20210514113603774\"></p>\n<p>D C</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514113939222.png\" alt=\"image-20210514113939222\"></p>\n<p>参数非ASCII文本，都做过401534函参</p>\n<p>猜ta解密函数：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514114121601.png\" alt=\"image-20210514114121601\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514114111181.png\" alt=\"image-20210514114111181\"></p>\n<p>原理：按位取反</p>\n<p>第5章idc脚本改写：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>62个字符&#x3D;0x3E  i &lt;&#x3D; 0x3E</p>\n<p>b^0xFF</p></blockquote>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514114401284.png\" alt=\"image-20210514114401284\"></p>\n<p>光标 file script  .idc</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514114458013.png\" alt=\"image-20210514114458013\"></p>\n<p>DCDC</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514114525741.png\" alt=\"image-20210514114525741\"></p>\n<p>exec spoolsrv.exe</p>\n<h1 id=\"16-反调试\"><a href=\"#16-反调试\" class=\"headerlink\" title=\"16 反调试\"></a>16 反调试</h1><h2 id=\"16-1-调试状态3标志\"><a href=\"#16-1-调试状态3标志\" class=\"headerlink\" title=\"16-1 调试状态3标志\"></a>16-1 调试状态3标志</h2><p>一系列验证，失败401000  自删除end</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514115329727.png\" alt=\"image-20210514115329727\"></p>\n<p>401000：</p>\n<p>bp 4010de</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514115421839.png\" alt=\"image-20210514115421839\"></p>\n<p>xref 79次</p>\n<p>403554处</p>\n<p>fs：0 保存TEB</p>\n<p>windbg kernel local本地内核调试：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>dt _teb</p></blockquote>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514115717266.png\" alt=\"image-20210514115717266\"></p>\n<p>fs：30h 保存PEB</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514115956087.png\" alt=\"image-20210514115956087\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514115809744.png\" alt=\"image-20210514115809744\"></p>\n<p>0没被调试</p>\n<p>【反调试！！！】</p>\n<p>去bp 重新载入</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514120038285.png\" alt=\"image-20210514120038285\"></p>\n<p>法一：手动1改0</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514120258571.png\" alt=\"image-20210514120258571\"></p>\n<p><strong>法二：OD插件PhantOm：   hide from PEB</strong></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514120335919.png\" alt=\"image-20210514120335919\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514120557798.png\" alt=\"image-20210514120557798\"></p>\n<p>PEB+18h: ProcessHeap</p>\n<p>opcode bytes: 5  无硬编码 错误指令：忽略ta！！！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514120823185.png\" alt=\"image-20210514120823185\"></p>\n<p>ProcessHeap+10h：ForceFlags&#x3D;&#x3D;beingDebugged 0没被调试</p>\n<p>已auto解决,先移除phantOm</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514121056241.png\" alt=\"image-20210514121056241\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514121228661.png\" alt=\"image-20210514121228661\"></p>\n<p>PEB+68h&#x3D;NtGlobalFlag</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514121506120.png\" alt=\"image-20210514121506120\"></p>\n<p>自动屏蔽，插件已移除</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514121621435.png\" alt=\"image-20210514121621435\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514121642165.png\" alt=\"image-20210514121642165\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514121830563.png\" alt=\"image-20210514121830563\"></p>\n<h2 id=\"16-2-TLS回调\"><a href=\"#16-2-TLS回调\" class=\"headerlink\" title=\"16-2 TLS回调\"></a>16-2 TLS回调</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514122104482.png\" alt=\"image-20210514122104482\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514122139315.png\" alt=\"image-20210514122139315\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514122231372.png\" alt=\"image-20210514122231372\"></p>\n<p>4.40123A</p>\n<p>5.反反调试太强，改用英文原版OD：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514122431101.png\" alt=\"image-20210514122431101\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514122450422.png\" alt=\"image-20210514122450422\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514122515216.png\" alt=\"image-20210514122515216\"></p>\n<ol start=\"6\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514122558508.png\" alt=\"image-20210514122558508\"></p>\n<p>tls回调在OEP前执行retn</p>\n<ol start=\"7\">\n<li></li>\n</ol>\n<p>【ctrl+E】</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514122803945.png\" alt=\"image-20210514122803945\"></p>\n<ol start=\"8\">\n<li></li>\n</ol>\n<p>tls作为启动过程的结果被调用</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514123047449.png\" alt=\"image-20210514123047449\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514123134573.png\" alt=\"image-20210514123134573\"></p>\n<p>Spy++ search -find window 拖到OD：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514123253322.png\" alt=\"image-20210514123253322\"></p>\n<p>新版OD：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514123327990.png\" alt=\"image-20210514123327990\"></p>\n<p>对抗FindWindow反调试！</p>\n<p>避免：原版+plugin\\ 拷贝phantom</p>\n<p>改ini：更新plugin path路径</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514123613214.png\" alt=\"image-20210514123613214\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514123652222.png\" alt=\"image-20210514123652222\"></p>\n<p>载入exe：<br><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514123711295.png\" alt=\"image-20210514123711295\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514161046345.png\" alt=\"image-20210514161046345\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514123740303.png\" alt=\"image-20210514123740303\"></p>\n<ol start=\"9\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514151632131.png\" alt=\"image-20210514151632131\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514151937416.png\" alt=\"image-20210514151937416\"></p>\n<p>bp 40123A</p>\n<p>【F4】size&#x3D;4</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514152104124.png\" alt=\"image-20210514152104124\"></p>\n<p>bzqr</p>\n<ol start=\"10\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514152214158.png\" alt=\"image-20210514152214158\"></p>\n<ol start=\"11\">\n<li></li>\n</ol>\n<p>入str2</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514152320220.png\" alt=\"image-20210514152320220\"></p>\n<p>右键Array</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514152446522.png\" alt=\"image-20210514152446522\"></p>\n<p>rename：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514152549680.png\" alt=\"image-20210514152549680\"></p>\n<p>esc</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514152645540.png\" alt=\"image-20210514152645540\"></p>\n<p>过于复杂，只看要点</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514152829699.png\" alt=\"image-20210514152829699\"></p>\n<p>让beingdebugged恒&#x3D;&#x3D;0：</p>\n<p>OD   phantom-hide from PEB</p>\n<p>重载</p>\n<p>G 40123A   F4</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514153037188.png\" alt=\"image-20210514153037188\"></p>\n<p>bzrr还是提示 错！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514153134430.png\" alt=\"image-20210514153134430\"></p>\n<p>xref</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514153219976.png\" alt=\"image-20210514153219976\"></p>\n<p>设置错误码&#x3D;3039h</p>\n<p>调试器打印b<br>cmp（3039h, cur错误码）</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514153813507.png\" alt=\"image-20210514153813507\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514154909376.png\" alt=\"image-20210514154909376\"></p>\n<p>命令行中run，OutputDebugStringA失败，全新错误码，不++：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514154425104.png\" alt=\"image-20210514154425104\"></p>\n<p>space、nop：永远不++</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514155314812.png\" alt=\"image-20210514155314812\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514155346621.png\" alt=\"image-20210514155346621\"></p>\n<p>save file: Lab16-02_patched.exe</p>\n<p>载入patched.exe 1234：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514155512709.png\" alt=\"image-20210514155512709\"></p>\n<p>bp 40123A  F4</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514155558619.png\" alt=\"image-20210514155558619\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514155647020.png\" alt=\"image-20210514155647020\"></p>\n<p>tls：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514160128605.png\" alt=\"image-20210514160128605\"></p>\n<p>cmp arg4,1 进程启动时call tls</p>\n<p>cmp arg4,2 线程启动时call tls         CreateThread , call OutputDebugString时</p>\n<p>猜：cmp arg4,3 进程终止时call tls</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514161331604.png\" alt=\"image-20210514161331604\"></p>\n<p>3.byrr, 不同方法，得到的命令行密码不同</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514161540572.png\" alt=\"image-20210514161540572\"></p>\n<h2 id=\"16-3-时间差-类似9-2\"><a href=\"#16-3-时间差-类似9-2\" class=\"headerlink\" title=\"16-3 时间差 类似9-2\"></a>16-3 时间差 类似9-2</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514165646247.png\" alt=\"image-20210514165646247\"></p>\n<ol>\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514162300560.png\" alt=\"image-20210514162300560\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>发DNS请求</p>\n<p>apateDNS监控：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514162413273.png\" alt=\"image-20210514162413273\"></p>\n<p>run，nothing。。。</p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>【r】</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514162524001.png\" alt=\"image-20210514162524001\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514162557241.png\" alt=\"image-20210514162557241\"></p>\n<p>OD： G 401518 F4</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514162735476.png\" alt=\"image-20210514162735476\"></p>\n<p>重启apateDNS</p>\n<p>改名 run</p>\n<p>监控nothing。。。</p>\n<p>向上找</p>\n<p>4014C3  【F4】</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514163042826.png\" alt=\"image-20210514163042826\"></p>\n<p>into 4011E0:</p>\n<p>获取精确的时间差&gt;1200ms,var118 1置2</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514164158981.png\" alt=\"image-20210514164158981\"></p>\n<p>less</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514164403384.png\" alt=\"image-20210514164403384\"></p>\n<p>OD中：401286 F4 单步</p>\n<p>&lt;&#x3D; ，var118依旧是1</p>\n<p> 猜：OD外run，&gt; 置2了崩了               直接NOP掉！！！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514165218459.png\" alt=\"image-20210514165218459\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514165256388.png\" alt=\"image-20210514165256388\"></p>\n<p>全部内容-保存文件：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514165333315.png\" alt=\"image-20210514165333315\"></p>\n<p>删、替换原文件、rename qgr.exe</p>\n<p>G(strncmp) 401518      F4</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514165506548.png\" alt=\"image-20210514165506548\"></p>\n<p><strong>改名为peo.exe</strong></p>\n<p>run</p>\n<p>监控到了！！！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514165552845.png\" alt=\"image-20210514165552845\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514165709660.png\" alt=\"image-20210514165709660\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>into 4011E0:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514165927756.png\" alt=\"image-20210514165927756\"></p>\n<p>$：当前指令地址</p>\n<p>401228入栈，跳到EIP新地址去执行</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514170609056.png\" alt=\"image-20210514170609056\"></p>\n<p>get EIP值–&gt;给EAX</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514170947116.png\" alt=\"image-20210514170947116\"></p>\n<p>401254处：用于删除异常处理的例程</p>\n<p>OD会花大量时间进行异常处理，通过此时间差判定run在OD中</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514171227569.png\" alt=\"image-20210514171227569\"></p>\n<p>OD</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514171532105.png\" alt=\"image-20210514171532105\"></p>\n<p>4015B4 出现无法处理的异常:   below</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514171749773.png\" alt=\"image-20210514171749773\"></p>\n<p>非法操作：Write [0]</p>\n<p>nop掉左分支： </p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514172118708.png\" alt=\"image-20210514172118708\"></p>\n<p>copy到exe-所有修改-全部复制-保存文件_</p>\n<p>覆盖原peo.exe：异常不存在了<br><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514172357291.png\" alt=\"image-20210514172357291\"></p>\n<p>rdtsc*2 系统启动以来的时钟数</p>\n<p>div 0</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514173027791.png\" alt=\"image-20210514173027791\"></p>\n<p>OD已自动更正：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514173132164.png\" alt=\"image-20210514173132164\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514173146848.png\" alt=\"image-20210514173146848\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514173242377.png\" alt=\"image-20210514173242377\"></p>\n<p>自删除+exit，OD中call     nop掉！！！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514173346829.png\" alt=\"image-20210514173346829\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514174628868.png\" alt=\"image-20210514174628868\"></p>\n<p>修改字符串</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514174848681.png\" alt=\"image-20210514174848681\"></p>\n<p>触发非法写入异常</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514174701541.png\" alt=\"image-20210514174701541\"></p>\n<p>自删除+exit</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514174727144.png\" alt=\"image-20210514174727144\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514174436984.png\" alt=\"image-20210514174436984\"></p>\n<h1 id=\"17-反VM\"><a href=\"#17-反VM\" class=\"headerlink\" title=\"17 反VM\"></a>17 反VM</h1><h2 id=\"17-1-lt-—-7-1\"><a href=\"#17-1-lt-—-7-1\" class=\"headerlink\" title=\"17-1&lt;—-7-1\"></a>17-1&lt;—-7-1</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514215756693.png\" alt=\"image-20210514215756693\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514215833947.png\" alt=\"image-20210514215833947\"></p>\n<p>python-2.6.6.msi</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514215457398.png\" alt=\"image-20210514215457398\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514215315292.png\" alt=\"image-20210514215315292\"></p>\n<p>同时拷贝2个plugins</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514215339371.png\" alt=\"image-20210514215339371\"></p>\n<p>file-script:</p>\n<p>findAntiVM.py</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">from idautils import *\nfrom idc import *\n\nheads &#x3D; Heads(SegStart(ScreenEA()), SegEnd(ScreenEA()))\nantiVM &#x3D; []\nfor i in heads:\n\tif (GetMnem(i) &#x3D;&#x3D; &quot;sidt&quot; or GetMnem(i) &#x3D;&#x3D; &quot;sgdt&quot; or GetMnem(i) &#x3D;&#x3D; &quot;sldt&quot; or GetMnem(i) &#x3D;&#x3D; &quot;smsw&quot; or GetMnem(i) &#x3D;&#x3D; &quot;str&quot; or GetMnem(i) &#x3D;&#x3D; &quot;in&quot; or GetMnem(i) &#x3D;&#x3D; &quot;cpuid&quot;):\n\t\tantiVM.append(i)\n\nprint &quot;Number of potential Anti-VM instructions: %d&quot; % (len(antiVM))\n\nfor i in antiVM:\n\tSetColor(i, CIC_ITEM, 0x0000ff)\n\tMessage(&quot;Anti-VM: %08x\\n&quot; % i)</code></pre>\n\n<p>GetMnem(i) &#x3D;&#x3D; “sidt”  sldt  str    sgdt     smsw   in     cpuid    ??????????????????????</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514215604933.png\" alt=\"image-20210514215604933\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514215626834.png\" alt=\"image-20210514215626834\"></p>\n<p>红色高亮 sldt sidt str指令</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514220045930.png\" alt=\"image-20210514220045930\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514220033082.png\" alt=\"image-20210514220033082\"></p>\n<p>3.4.5.6.</p>\n<p>sldt</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514220730147.png\" alt=\"image-20210514220730147\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514220953246.png\" alt=\"image-20210514220953246\"></p>\n<p>sidt</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514221146088.png\" alt=\"image-20210514221146088\"></p>\n<p>自删除：<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514221157498.png\" alt=\"image-20210514221157498\"></p>\n<p>VM多核形式: ECX&#x3D;F7   VMware特征：FF</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514221414138.png\" alt=\"image-20210514221414138\"></p>\n<p>检查会失败</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514221554143.png\" alt=\"image-20210514221554143\"></p>\n<p>or改为F7，or改为单核VM</p>\n<p>str</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514222150959.png\" alt=\"image-20210514222150959\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514222307524.png\" alt=\"image-20210514222307524\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514222323667.png\" alt=\"image-20210514222323667\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210514222410221.png\" alt=\"image-20210514222410221\"></p>\n<h2 id=\"17-2-尝试禁用\"><a href=\"#17-2-尝试禁用\" class=\"headerlink\" title=\"17-2 尝试禁用\"></a>17-2 尝试禁用</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515093940403.png\" alt=\"image-20210515093940403\"></p>\n<p>PEiD</p>\n<p><strong>rundll32.exe dll,ExportFunc</strong></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515094343433.png\" alt=\"image-20210515094343433\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515094931132.png\" alt=\"image-20210515094931132\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515095634749.png\" alt=\"image-20210515095634749\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515095748711.png\" alt=\"image-20210515095748711\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515095800333.png\" alt=\"image-20210515095800333\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515095821413.png\" alt=\"image-20210515095821413\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515095115499.png\" alt=\"image-20210515095115499\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515095543225.png\" alt=\"image-20210515095543225\"></p>\n<p>5567 xref: InstallRT</p>\n<p>打开log 写入log</p>\n<p>10006196：反VM</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515100239856.png\" alt=\"image-20210515100239856\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515100458963.png\" alt=\"image-20210515100458963\"></p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515100817347.png\" alt=\"image-20210515100817347\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515104544195.png\" alt=\"image-20210515104544195\"></p>\n<ol start=\"6\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515101313980.png\" alt=\"image-20210515101313980\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515100954157.png\" alt=\"image-20210515100954157\"></p>\n<p>改串为”[…]0”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515101714579.png\" alt=\"image-20210515101714579\"></p>\n<p>或者OD改检查指令，保存</p>\n<ol start=\"7\">\n<li></li>\n</ol>\n<p>InstallRT的1000D3D0、1000D10D</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515102326670.png\" alt=\"image-20210515102326670\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515101937550.png\" alt=\"image-20210515101937550\"></p>\n<p>InstallSA:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515103138770.png\" alt=\"image-20210515103138770\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515103204335.png\" alt=\"image-20210515103204335\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515103220079.png\" alt=\"image-20210515103220079\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515103242167.png\" alt=\"image-20210515103242167\"></p>\n<p>InstallSB:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515103429862.png\" alt=\"image-20210515103429862\"></p>\n<p>5A0A禁用文件保护 (12-4)</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515103547274.png\" alt=\"image-20210515103547274\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515104739137.png\" alt=\"image-20210515104739137\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515104318767.png\" alt=\"image-20210515104318767\"></p>\n<h1 id=\"留待分析。。。\"><a href=\"#留待分析。。。\" class=\"headerlink\" title=\"留待分析。。。\"></a>留待分析。。。</h1><h2 id=\"17-3-lt-—-12-2\"><a href=\"#17-3-lt-—-12-2\" class=\"headerlink\" title=\"17-3&lt;—-12-2\"></a>17-3&lt;—-12-2</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515111503538.png\" alt=\"image-20210515111503538\"></p>\n<ol>\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515111539518.png\" alt=\"image-20210515111539518\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>findAntiVM.py</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515111635859.png\" alt=\"image-20210515111635859\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515112000775.png\" alt=\"image-20210515112000775\"></p>\n<p>string:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515112146273.png\" alt=\"image-20210515112146273\"></p>\n<p>xref</p>\n<p>view-graphs-User xrefs chart</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515112458353.png\" alt=\"image-20210515112458353\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515112533195.png\" alt=\"image-20210515112533195\"></p>\n<p>判断自己是否在虚拟机中</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515113052269.png\" alt=\"image-20210515113052269\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515113106729.png\" alt=\"image-20210515113106729\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515112905800.png\" alt=\"image-20210515112905800\"></p>\n<p>xor xor</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515113403949.png\" alt=\"image-20210515113403949\"></p>\n<p>rename   xref</p>\n<p>var_38右键array 27，rename为Byte_Array</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515113628459.png\" alt=\"image-20210515113628459\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515113753953.png\" alt=\"image-20210515113753953\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515113842734.png\" alt=\"image-20210515113842734\"></p>\n<p>分配空间lpMem[dwBytes]，第2次调AdaptersInfo</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515113949593.png\" alt=\"image-20210515113949593\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515114523443.png\" alt=\"image-20210515114523443\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515114614591.png\" alt=\"image-20210515114614591\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515114632662.png\" alt=\"image-20210515114632662\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515114710912.png\" alt=\"image-20210515114710912\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515114900676.png\" alt=\"image-20210515114900676\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515115231747.png\" alt=\"image-20210515115231747\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515115626684.png\" alt=\"image-20210515115626684\"></p>\n<p><strong>jmp资源节，跳过适配器检查！！！！</strong></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515115703217.png\" alt=\"image-20210515115703217\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515120558630.png\" alt=\"image-20210515120558630\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515120907866.png\" alt=\"image-20210515120907866\"></p>\n<p>nop掉40145D处 1130函数调用</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515121639029.png\" alt=\"image-20210515121639029\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210515121714978.png\" alt=\"image-20210515121714978\"></p>\n<h1 id=\"18-加壳脱壳-easy\"><a href=\"#18-加壳脱壳-easy\" class=\"headerlink\" title=\"18 加壳脱壳  easy\"></a>18 加壳脱壳  easy</h1><h2 id=\"18-1-尾部跳转OEP\"><a href=\"#18-1-尾部跳转OEP\" class=\"headerlink\" title=\"18-1 尾部跳转OEP\"></a>18-1 尾部跳转OEP</h2><p>peid-&gt;Hard core scan: UPX压缩壳</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519160100886.png\" alt=\"image-20210519160100886\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519160108206.png\" alt=\"image-20210519160108206\"></p>\n<p>next F2bp F9run：执行过loop</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519160519468.png\" alt=\"image-20210519160519468\"></p>\n<p>尾部跳转</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519160816146.png\" alt=\"image-20210519160816146\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519160856970.png\" alt=\"image-20210519160856970\"></p>\n<p>F2bp F9run F8over</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519160953174.png\" alt=\"image-20210519160953174\"></p>\n<p>OEP！！！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519161051579.png\" alt=\"image-20210519161051579\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519161205342.png\" alt=\"image-20210519161205342\"></p>\n<p>unpacked</p>\n<p>ImpREC:修复导入表</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519161343124.png\" alt=\"image-20210519161343124\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519161512198.png\" alt=\"image-20210519161512198\"></p>\n<p>unpacked.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519161549811.png\" alt=\"image-20210519161549811\"></p>\n<p>脱壳成功：unpacked_.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519161623780.png\" alt=\"image-20210519161623780\"></p>\n<p>run 没报错</p>\n<p>同14-1</p>\n<h2 id=\"18-2-OllyDump-find-OEP-by-section-hop\"><a href=\"#18-2-OllyDump-find-OEP-by-section-hop\" class=\"headerlink\" title=\"18-2 OllyDump: find OEP by section hop\"></a>18-2 OllyDump: find OEP by section hop</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519162611598.png\" alt=\"image-20210519162611598\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519162653998.png\" alt=\"image-20210519162653998\"></p>\n<p>分析-分析代码</p>\n<p>dump debugged process</p>\n<p>去rebuild import</p>\n<p>Modify：1090</p>\n<p>dump：unpacked</p>\n<p>ImpREC：18-02.exe</p>\n<p>OEP：1090</p>\n<p>IAT autoSearch</p>\n<p>get Imported</p>\n<p>fix dump: unpacked</p>\n<p>同7-2</p>\n<h2 id=\"18-3-ESP定律脱壳法\"><a href=\"#18-3-ESP定律脱壳法\" class=\"headerlink\" title=\"18-3 ESP定律脱壳法\"></a>18-3 ESP定律脱壳法</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519163224704.png\" alt=\"image-20210519163224704\"></p>\n<p>OD：pushad</p>\n<p>trace into 不对</p>\n<p>trace over</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519162653998.png\" alt=\"image-20210519162653998\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519163409686.png\" alt=\"image-20210519163409686\"></p>\n<p>找连续0000 尾部跳转:jmp &#x2F; retn</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519163522290.png\" alt=\"image-20210519163522290\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519163546990.png\" alt=\"image-20210519163546990\"></p>\n<p>没找到</p>\n<p>删调试信息</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519163627335.png\" alt=\"image-20210519163627335\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519163945828.png\" alt=\"image-20210519163945828\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519164035739.png\" alt=\"image-20210519164035739\"></p>\n<p>run：</p>\n<p>popfd  retn尾部跳转【F8】</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519164127463.png\" alt=\"image-20210519164127463\"></p>\n<p>分析代码：OEP！！！</p>\n<p><strong>依据堆栈平衡原理：ESP定律脱壳法</strong></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519164350716.png\" alt=\"image-20210519164350716\"></p>\n<p>dump debugged process</p>\n<p>去rebuild import</p>\n<p>Modify：</p>\n<p>dump：unpacked</p>\n<p>ImpREC：18-03.exe</p>\n<p>OEP：</p>\n<p>IAT autoSearch</p>\n<p>get Imported</p>\n<p>fix dump: unpacked</p>\n<p>unpacked_  PEiD：VC++6.0</p>\n<p>同9-2</p>\n<h2 id=\"18-4-同3\"><a href=\"#18-4-同3\" class=\"headerlink\" title=\"18-4 同3\"></a>18-4 同3</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519164621995.png\" alt=\"image-20210519164621995\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519164705106.png\" alt=\"image-20210519164705106\"></p>\n<p>栈上设置硬件访问断点，找popad</p>\n<p>【F8】 esp变化 ：数据窗口中跟随</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519165040818.png\" alt=\"image-20210519165040818\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519165104452.png\" alt=\"image-20210519165104452\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519165135385.png\" alt=\"image-20210519165135385\"></p>\n<p>OEP</p>\n<p>dump debugged process</p>\n<p>去rebuild import</p>\n<p>Modify：</p>\n<p>dump：unpacked</p>\n<p>ImpREC：18-04.exe</p>\n<p>OEP：</p>\n<p>IAT autoSearch</p>\n<p>get Imported</p>\n<p>fix dump: unpacked</p>\n<p>unpacked_  PEiD：VC++6.0</p>\n<p>同9-1</p>\n<h2 id=\"18-5-同\"><a href=\"#18-5-同\" class=\"headerlink\" title=\"18-5 同\"></a>18-5 同</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519165513936.png\" alt=\"image-20210519165513936\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519165539362.png\" alt=\"image-20210519165539362\"></p>\n<p>【F8】到ESP变红 数据窗口跟随</p>\n<p>断电 硬件访问 DWORD</p>\n<p>分析代码</p>\n<p>dump debugged process</p>\n<p>去rebuild import</p>\n<p>Modify：1190</p>\n<p>dump：unpacked</p>\n<p>ImpREC：18-04.exe</p>\n<p>OEP：1190</p>\n<p>IAT autoSearch</p>\n<p>get Imported</p>\n<p>fix dump: unpacked</p>\n<p>unpacked_  PEiD：VC++6.0</p>\n<p>同7-1</p>\n<h1 id=\"19-Shellcode分析。。。\"><a href=\"#19-Shellcode分析。。。\" class=\"headerlink\" title=\"19 Shellcode分析。。。\"></a>19 Shellcode分析。。。</h1><h2 id=\"19-1-idc解密-scdbg\"><a href=\"#19-1-idc解密-scdbg\" class=\"headerlink\" title=\"19-1 idc解密 scdbg\"></a>19-1 idc解密 scdbg</h2><p>bin IDA</p>\n<p>【C】</p>\n<p>200处：ecx cnter</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519171405641.png\" alt=\"image-20210519171405641\"></p>\n<p>call sub_208作用: push 224(next addr)</p>\n<p>pop esi&#x3D;224</p>\n<p>lodsb: esi-&gt;eax 依据DF(direction标志位)esi++&#x2F;–</p>\n<p>224处【D】<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519171835942.png\" alt=\"image-20210519171835942\"></p>\n<p>49h存入eax</p>\n<p>esi自增为225【D】4Ah</p>\n<p>stosb:eax-&gt;[edi&#x3D;224]  依据DF(direction标志位)edi++&#x2F;–</p>\n<p>解码！！！</p>\n<p>idc   i&lt;&#x3D;0x18D？？？？</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519172623162.png\" alt=\"image-20210519172623162\"></p>\n<p>光标224处 file-script idc</p>\n<p>【C】</p>\n<p>IDA没识别shellcode</p>\n<p>将实验数据保存到19-1.exe ，源代码lab19-01.cpp：借用缓冲区溢出分析程序 strcpy</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519173111656.png\" alt=\"image-20210519173111656\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519173125157.png\" alt=\"image-20210519173125157\"></p>\n<p>OD 19-1.exe：</p>\n<p>4016B4：main</p>\n<p>F7 into</p>\n<p>retn处F2 F9run</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519173502572.png\" alt=\"image-20210519173502572\"></p>\n<p>【enter】响应</p>\n<p>【F8】单步</p>\n<p>解密函数：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519173557557.png\" alt=\"image-20210519173557557\"></p>\n<p>retn处F2 F9run</p>\n<p>解密完成</p>\n<p>shellcode开始工作。。。</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519173726305.png\" alt=\"image-20210519173726305\"></p>\n<h1 id=\"详见P654-655。。。\"><a href=\"#详见P654-655。。。\" class=\"headerlink\" title=\"详见P654-655。。。\"></a>详见P654-655。。。</h1><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519170241867.png\" alt=\"image-20210519170241867\"></p>\n<p>OD动态调试 </p>\n<p>scdbg</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519174240537.png\" alt=\"image-20210519174240537\"></p>\n<h2 id=\"19-2\"><a href=\"#19-2\" class=\"headerlink\" title=\"19-2\"></a>19-2</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519181600485.png\" alt=\"image-20210519181600485\"></p>\n<p>IDA：各个call </p>\n<p>提权</p>\n<p>reg里获取默认浏览器路径</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519175954132.png\" alt=\"image-20210519175954132\"></p>\n<p>启动【不可见】浏览器进程</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519180043329.png\" alt=\"image-20210519180043329\"></p>\n<p>unk_407030: shellcode注入浏览器</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519180205006.png\" alt=\"image-20210519180205006\"></p>\n<p>2.【C】</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519180516080.png\" alt=\"image-20210519180516080\"></p>\n<p>3.解密idc</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519180538042.png\" alt=\"image-20210519180538042\"></p>\n<p>4.5.</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519180635670.png\" alt=\"image-20210519180635670\"></p>\n<ol start=\"6\">\n<li></li>\n</ol>\n<p>shellcode为了通用性：动态获取API addr，再调用func</p>\n<p>kernel32.dll</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519180855541.png\" alt=\"image-20210519180855541\"></p>\n<p>“loadlibraryA” hash运算，使短小精悍！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519181019753.png\" alt=\"image-20210519181019753\"></p>\n<p>str代码放在4071BB</p>\n<p>func name &#x2F; 4B</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519181122880.png\" alt=\"image-20210519181122880\"></p>\n<p>4071BB add入栈 ，再call</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519181325285.png\" alt=\"image-20210519181325285\"></p>\n<p>ebx操控funcName hash值</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519181411956.png\" alt=\"image-20210519181411956\"></p>\n<p>call CreateProcess</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519181433248.png\" alt=\"image-20210519181433248\"></p>\n<p>shellcode功能：建立远程shell</p>\n<h1 id=\"详见P657-660。。。\"><a href=\"#详见P657-660。。。\" class=\"headerlink\" title=\"详见P657-660。。。\"></a>详见P657-660。。。</h1><h2 id=\"19-3-PDFStreamDumper-堆喷射\"><a href=\"#19-3-PDFStreamDumper-堆喷射\" class=\"headerlink\" title=\"19-3 PDFStreamDumper 堆喷射\"></a>19-3 PDFStreamDumper 堆喷射</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519221828554.png\" alt=\"image-20210519221828554\"></p>\n<p>AdobeReader8.1.2及之前版本中</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519223211152.png\" alt=\"image-20210519223211152\"></p>\n<p>JS percent encoding 编码方式：</p>\n<p>%u：ASCII 16进制 2B</p>\n<p>89e581ec</p>\n<p>%：ASCII 16进制 1B</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519222635968.png\" alt=\"image-20210519222635968\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519220437357.png\" alt=\"image-20210519220437357\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519220521117.png\" alt=\"image-20210519220521117\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519220921212.png\" alt=\"image-20210519220921212\"></p>\n<p>ShellExec: 用默认pdf阅读器打开bar.pdf</p>\n<p>_sc.bin IDA:</p>\n<p>【C】hashed func name</p>\n<p>call 17B - call CA:FindKernel32base</p>\n<p>195 call：hash值计算</p>\n<p>loadlibrary函参shell32.dll<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519221457158.png\" alt=\"image-20210519221457158\"></p>\n<p>getTempPath<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519221554939.png\" alt=\"image-20210519221554939\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519221617822.png\" alt=\"image-20210519221617822\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519221638519.png\" alt=\"image-20210519221638519\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519221653300.png\" alt=\"image-20210519221653300\"></p>\n<p>shellcode解析详见P665-669。。。</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519222838493.png\" alt=\"image-20210519222838493\"></p>\n<h1 id=\"20-C-代码分析\"><a href=\"#20-C-代码分析\" class=\"headerlink\" title=\"20 C++代码分析\"></a>20 C++代码分析</h1><h2 id=\"20-1-ECX传递对象索引：this指针\"><a href=\"#20-1-ECX传递对象索引：this指针\" class=\"headerlink\" title=\"20-1  ECX传递对象索引：this指针\"></a>20-1  ECX传递对象索引：this指针</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519223830297.png\" alt=\"image-20210519223830297\"></p>\n<p>new obj</p>\n<p>this指针</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519224041844.png\" alt=\"image-20210519224041844\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519224011881.png\" alt=\"image-20210519224011881\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519224135411.png\" alt=\"image-20210519224135411\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519224211414.png\" alt=\"image-20210519224211414\"></p>\n<h2 id=\"20-2虚函数-FTP\"><a href=\"#20-2虚函数-FTP\" class=\"headerlink\" title=\"20-2虚函数 FTP\"></a>20-2虚函数 FTP</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519224346798.png\" alt=\"image-20210519224346798\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520103644270.png\" alt=\"image-20210520103644270\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520103819231.png\" alt=\"image-20210520103819231\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520104005371.png\" alt=\"image-20210520104005371\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520104124006.png\" alt=\"image-20210520104124006\"></p>\n<p>findfirst&#x2F;nextFile</p>\n<p>strncmp</p>\n<p>_strlen</p>\n<p>strcat</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520104319311.png\" alt=\"image-20210520104319311\"></p>\n<p>new doc_obj</p>\n<p>虚函数表4060DC 写入该new doc_obj</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520104529620.png\" alt=\"image-20210520104529620\"></p>\n<p>401440<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520104423647.png\" alt=\"image-20210520104423647\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520104806407.png\" alt=\"image-20210520104806407\"></p>\n<p>同理判pdf</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520104953229.png\" alt=\"image-20210520104953229\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520105012218.png\" alt=\"image-20210520105012218\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520105058090.png\" alt=\"image-20210520105058090\"></p>\n<p>其他</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520105148219.png\" alt=\"image-20210520105148219\"></p>\n<p>40132F：</p>\n<p>pdf、doc 与 other 操作不同</p>\n<p>看pdf虚函数</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520105352732.png\" alt=\"image-20210520105352732\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520105440925.png\" alt=\"image-20210520105440925\"></p>\n<p>doc虚函数“%s-%d.doc”</p>\n<p>other：nothing。。。</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520105522113.png\" alt=\"image-20210520105522113\"></p>\n<p>C盘新建</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520105652926.png\" alt=\"image-20210520105652926\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210519224255973.png\" alt=\"image-20210519224255973\">创建虚拟网络环境</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520105725481.png\" alt=\"image-20210520105725481\"></p>\n<p>向ftp.blabla.com发请求，ApateDNS将请求重定向到本地PC上 DNS reply IP: 127.0.0.1</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520110022234.png\" alt=\"image-20210520110022234\"></p>\n<p>run</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520110051204.png\" alt=\"image-20210520110051204\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520110130424.png\" alt=\"image-20210520110130424\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520110325460.png\" alt=\"image-20210520110325460\"></p>\n<h2 id=\"20-3-异常-http-get-post\"><a href=\"#20-3-异常-http-get-post\" class=\"headerlink\" title=\"20-3 异常 http get post\"></a>20-3 异常 http get post</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520110511958.png\" alt=\"image-20210520110511958\"></p>\n<p>IDA Strings window</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520110611740.png\" alt=\"image-20210520110611740\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520110735034.png\" alt=\"image-20210520110735034\"></p>\n<p>为获取执行命令轮询远程服务器</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520110918313.png\" alt=\"image-20210520110918313\"></p>\n<p>后门程序</p>\n<p>Imports：W32    CreateProcess</p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>401EE0是new obj所属类的成员函数</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520111253086.png\" alt=\"image-20210520111253086\"></p>\n<p>into+ into</p>\n<p>4036F0：异常对象的成员函数</p>\n<p>初始化异常</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520111721342.png\" alt=\"image-20210520111721342\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520111858699.png\" alt=\"image-20210520111858699\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>esc </p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520111938444.png\" alt=\"image-20210520111938444\"></p>\n<p>esc</p>\n<hr>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520112049313.png\" alt=\"image-20210520112049313\"></p>\n<p>401F80：发送信号，读响应</p>\n<p>1 into</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520112132301.png\" alt=\"image-20210520112132301\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520112151546.png\" alt=\"image-20210520112151546\"></p>\n<p>2 into</p>\n<p>不断获取计算机信息</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520112242411.png\" alt=\"image-20210520112242411\"></p>\n<p>func 404ED0 </p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520112354062.png\" alt=\"image-20210520112354062\"></p>\n<p>404B10</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520112444872.png\" alt=\"image-20210520112444872\"></p>\n<hr>\n<p>402410：获取指令</p>\n<p>socket connection</p>\n<p>http get</p>\n<p>polling</p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>switch 6 cases:</p>\n<p>0x61<del>66: a</del>f</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520112943523.png\" alt=\"image-20210520112943523\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520113011880.png\" alt=\"image-20210520113011880\"></p>\n<p>delete</p>\n<p>atoi sleep</p>\n<p>into CreateProcess</p>\n<p>253B -2A20: CreateFile  将服务器获取的http响应写到本地disk</p>\n<p>用http post指令来uploadFIle</p>\n<p>受害主机信息发送到服务器</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520113501643.png\" alt=\"image-20210520113501643\"></p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520113829645.png\" alt=\"image-20210520113829645\"></p>\n<h1 id=\"10-WinDbg调试内核\"><a href=\"#10-WinDbg调试内核\" class=\"headerlink\" title=\"10 WinDbg调试内核\"></a>10 WinDbg调试内核</h1><h2 id=\"10-1-创建服务来加载驱动：创建内核态Reg键值-禁用防火墙\"><a href=\"#10-1-创建服务来加载驱动：创建内核态Reg键值-禁用防火墙\" class=\"headerlink\" title=\"10-1 创建服务来加载驱动：创建内核态Reg键值-禁用防火墙\"></a>10-1 创建服务来加载驱动：创建内核态Reg键值-禁用防火墙</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520114613517.png\" alt=\"image-20210520114613517\"></p>\n<p>IDA exe：</p>\n<p>imports  服务</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520114146113.png\" alt=\"image-20210520114146113\"></p>\n<p>Str</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520114226050.png\" alt=\"image-20210520114226050\"></p>\n<p>IDA sys：</p>\n<p>import  注册表</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520114323711.png\" alt=\"image-20210520114323711\"></p>\n<p>Strings sys：</p>\n<p>内核态Reg</p>\n<p>禁用防火墙</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520114514376.png\" alt=\"image-20210520114514376\"></p>\n<p>【猜测：创建服务来加载驱动：创建注册表键值-禁用防火墙】</p>\n<p>procmon filter exe: run 【检测不到内核态Reg变化】</p>\n<p>写了一个随机数 没意义。。。</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520114804614.png\" alt=\"image-20210520114804614\"></p>\n<p>IDA再分析exe：</p>\n<p>OpenSCManagerA</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520115036715.png\" alt=\"image-20210520115036715\"></p>\n<p>1 SERVICE_KERNEL_DRIVER</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520115327427.png\" alt=\"image-20210520115327427\"></p>\n<p>SERVICE_CONTROL_STOP 卸载驱动</p>\n<p>IDA sys:</p>\n<p>DriverEntry</p>\n<p>call 10906:</p>\n<p>偏移量–&gt;内存位置</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520115455016.png\" alt=\"image-20210520115455016\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520115555485.png\" alt=\"image-20210520115555485\"></p>\n<p>VM内</p>\n<p>WinDbg-Open executable: lab10-01.exe</p>\n<p>bp 00401080【ControlService地址】</p>\n<p>g</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520115900340.png\" alt=\"image-20210520115900340\"></p>\n<p>windbg指令，API文档。。。想要~~</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520120055460.png\" alt=\"image-20210520120055460\"></p>\n<p>宿主机</p>\n<p>双机调试 windbg VM</p>\n<p>!drvobj Lab10-01</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520120240502.png\" alt=\"image-20210520120240502\"></p>\n<p>该drv没有供用户空间中app使用的Device</p>\n<p>!object \\Driver    内核中所有驱动列表</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520120742381.png\" alt=\"image-20210520120742381\"></p>\n<p>dt解析为该数据结构</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520121050877.png\" alt=\"image-20210520121050877\"></p>\n<p>g</p>\n<p>g</p>\n<p>VM内g  又卡死</p>\n<p>宿主机单步<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520120938980.png\" alt=\"image-20210520120938980\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520121011232.png\" alt=\"image-20210520121011232\"></p>\n<p>结合IDA：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520121050877.png\" alt=\"image-20210520121050877\"></p>\n<p>偏移0x486</p>\n<p>IDA默认sys addr：0x00010000</p>\n<p>+486&#x3D;10486：函数卸载处</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520121323816.png\" alt=\"image-20210520121323816\"></p>\n<p>or：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520121535471.png\" alt=\"image-20210520121535471\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520121545731.png\" alt=\"image-20210520121545731\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520121706841.png\" alt=\"image-20210520121706841\"></p>\n<p>IDA addr与windbg addr保持一致了</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520122128678.png\" alt=\"image-20210520122128678\"></p>\n<h2 id=\"10-2-SSDT-R3-0通信-hook-NtQueryDirectoryFile-FILE-BOTH-DIR-INFORMATION“脱链”文件隐藏\"><a href=\"#10-2-SSDT-R3-0通信-hook-NtQueryDirectoryFile-FILE-BOTH-DIR-INFORMATION“脱链”文件隐藏\" class=\"headerlink\" title=\"10-2 SSDT(R3-0通信)hook NtQueryDirectoryFile+FILE_BOTH_DIR_INFORMATION“脱链”文件隐藏\"></a>10-2 SSDT(R3-0通信)hook NtQueryDirectoryFile+FILE_BOTH_DIR_INFORMATION“脱链”文件隐藏</h2><ol>\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520144552894.png\" alt=\"image-20210520144552894\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520144621812.png\" alt=\"image-20210520144621812\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520144639709.png\" alt=\"image-20210520144639709\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520144705003.png\" alt=\"image-20210520144705003\"></p>\n<p>宿主机windbg 双机调试：</p>\n<p>dd KeServiceDescriptorTable</p>\n<p>80502b8c函数指针数组：保存所有原生API函数的地址</p>\n<p>11c 数组大小</p>\n<p>80503000 参数个数 数组</p>\n<p>u</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520145854595.png\" alt=\"image-20210520145854595\"></p>\n<p>dd dwo(KeServiceDescriptorTable) L100 </p>\n<p>g</p>\n<p>g</p>\n<p>procmon filter 10-2.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520150029470.png\" alt=\"image-20210520150029470\"></p>\n<p>C盘 搜不到Mlwx486.sys</p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>IDA exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520150224693.png\" alt=\"image-20210520150224693\"></p>\n<p>PE res写入.sys文件</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520150252889.png\" alt=\"image-20210520150252889\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520150429422.png\" alt=\"image-20210520150429422\"></p>\n<p>sc query “service name”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520150455209.png\" alt=\"image-20210520150455209\"></p>\n<p>windbg     lm:系统读取的模块信息  </p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520150713523.png\" alt=\"image-20210520150713523\"></p>\n<p>没文件，用了Rootkit技术！！！</p>\n<p>根据nt范围，比较前后两次 dd dwo(KeServiceDescriptorTable) L100 变化</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520151412725.png\" alt=\"image-20210520151412725\">–&gt;<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520151218568.png\" alt=\"image-20210520151218568\"></p>\n<p>以b开头地址，是被PROCMON32修改的，忽略</p>\n<p>改了80570074这个地址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520151540900.png\" alt=\"image-20210520151540900\"></p>\n<p>NtQueryDirectoryFile：</p>\n<p>提取文件和目录信息的通用函数，findfirst&#x2F;nextfile,资源管理器用它显示管理目录</p>\n<p>rootkit钩取该函数，可实现文件隐藏</p>\n<p>被改后的地址下断点+g</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520151941858.png\" alt=\"image-20210520151941858\"></p>\n<p>p单步</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520152159540.png\" alt=\"image-20210520152159540\"></p>\n<p>提取资源Mlwx486.sys</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520152108834.png\" alt=\"image-20210520152108834\"></p>\n<p>IDA 该Mlwx486.sys：</p>\n<p>将基址改为内存中被改后的实际地址：f8cd8000</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520152327982.png\" alt=\"image-20210520152327982\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520152842047.png\" alt=\"image-20210520152842047\"></p>\n<p>3 FILE_BOTH_DIR_INFORMATION</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520152958229.png\" alt=\"image-20210520152958229\"></p>\n<p>是3 是0</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520153128874.png\" alt=\"image-20210520153128874\"></p>\n<p>source2：”Mlwx”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520153104670.png\" alt=\"image-20210520153104670\"></p>\n<p>esi+5Eh:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520153313640.png\" alt=\"image-20210520153313640\"></p>\n<p>匹配文件名，执行文件隐藏：</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520153355399.png\" alt=\"image-20210520153355399\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520154059401.png\" alt=\"image-20210520154059401\"></p>\n<p>该buffer当前ds就是FILE_BOTH_DIR_INFORMATION</p>\n<p>原理：链表删节点 “脱链”</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520154006778.png\" alt=\"image-20210520154006778\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520154403842.png\" alt=\"image-20210520154403842\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210520154646815.png\" alt=\"image-20210520154646815\"></p>\n<h2 id=\"10-3-eprocess的ActiveProcessLinks脱链\"><a href=\"#10-3-eprocess的ActiveProcessLinks脱链\" class=\"headerlink\" title=\"10-3 _eprocess的ActiveProcessLinks脱链\"></a>10-3 _eprocess的ActiveProcessLinks脱链</h2><p>改当前进程，获取信息</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521091955722.png\" alt=\"image-20210521091955722\"></p>\n<p>C:&#x2F;system32&#x2F;.sys</p>\n<p>run 任务管理器没该进程，删不了</p>\n<p>2.只能快照源OS，或重启</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521092409285.png\" alt=\"image-20210521092409285\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521092355638.png\" alt=\"image-20210521092355638\"></p>\n<p>IDA exe:</p>\n<p>service~~DeviceIoControl  加载和发送请求到内核驱动的函数</p>\n<p>OleInit… 使用COM对象</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521092708545.png\" alt=\"image-20210521092708545\"></p>\n<p>打开一个由ProcHelper驱动创建的内核设备句柄</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521092742779.png\" alt=\"image-20210521092742779\"></p>\n<p>向指定的设备驱动发送控制代码</p>\n<p>没IO信息，少见</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521093016410.png\" alt=\"image-20210521093016410\"></p>\n<p>下同7-2 COM</p>\n<p>IDA sys：</p>\n<p>创建设备对象</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521093113837.png\" alt=\"image-20210521093113837\"></p>\n<p>更容易被用户态app访问设备句柄</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521093317240.png\" alt=\"image-20210521093317240\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521093338461.png\" alt=\"image-20210521093338461\"></p>\n<p>windbg双机调试：</p>\n<p>!devobj ProcHelper</p>\n<p>dt _DRIVER_OBJECT  820df7e0</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521093637750.png\" alt=\"image-20210521093637750\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521093709375.png\" alt=\"image-20210521093709375\"></p>\n<p>IDA[G] DriverInit 的地址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521093811302.png\" alt=\"image-20210521093811302\"></p>\n<p>IDA[G] DriverUnload 的地址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521093846737.png\" alt=\"image-20210521093846737\"></p>\n<p>xp允许28&#x3D;&#x3D;0x1Ch种可能的MajorFunction</p>\n<p>dd 820df7e0+0x038 L1c</p>\n<p>804f454a:驱动不能处理的非法请求类型的处理程序</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521094414488.png\" alt=\"image-20210521094414488\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521094526291.png\" alt=\"image-20210521094526291\"></p>\n<p>606</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521094609796.png\" alt=\"image-20210521094609796\"></p>\n<p>nothing。。。</p>\n<p>666 DeviceIoControl：操纵PEB</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521095045142.png\" alt=\"image-20210521095045142\"></p>\n<p>返回调用DeviceIoControl的_EPROCESS结构 (未公开，只有wdk说明，无定义)</p>\n<p>dt _eprocess</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521095102549.png\" alt=\"image-20210521095102549\"></p>\n<p>双向链表</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521095321337.png\" alt=\"image-20210521095321337\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521095301952.png\" alt=\"image-20210521095301952\"></p>\n<p>脱链原理</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521095700078.png\" alt=\"image-20210521095700078\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521095932731.png\" alt=\"image-20210521095932731\"></p>\n<h1 id=\"21-64位恶意代码\"><a href=\"#21-64位恶意代码\" class=\"headerlink\" title=\"21 64位恶意代码\"></a>21 64位恶意代码</h1><h2 id=\"21-1\"><a href=\"#21-1\" class=\"headerlink\" title=\"21-1\"></a>21-1</h2><p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521100415914.png\" alt=\"image-20210521100415914\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521100449427.png\" alt=\"image-20210521100449427\"></p>\n<p>1.64VM run nothing。。。</p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>idaq64 exe:</p>\n<p>EntryPoint</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521100719627.png\" alt=\"image-20210521100719627\"></p>\n<p>3参 int ptr ptr</p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>ASCII   2E&#x3D;&#x3D;’.’</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521100935843.png\" alt=\"image-20210521100935843\"></p>\n<p>改名ocl.exe运行 nothing</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521101020568.png\" alt=\"image-20210521101020568\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>获取目录路径中的文件名r11 [&lt;-]</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521101140793.png\" alt=\"image-20210521101140793\"></p>\n<p>抽象的编码操作。。。跳过</p>\n<p>编码后str rcx &#x3D;&#x3D; jzm.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521101428156.png\" alt=\"image-20210521101428156\"></p>\n<p>nop掉jmp！！！</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521102029671.png\" alt=\"image-20210521102029671\"></p>\n<ol start=\"5\">\n<li></li>\n</ol>\n<p>VM内</p>\n<p>OD不支持64位调试，同windbg-amd64：</p>\n<p>file-open executable-ocl.exe:</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521102323964.png\" alt=\"image-20210521102323964\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521102444571.png\" alt=\"image-20210521102444571\"></p>\n<ol start=\"6\">\n<li></li>\n</ol>\n<p>参数：套接字。。。rbx</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521102628613.png\" alt=\"image-20210521102628613\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521102610663.png\" alt=\"image-20210521102610663\"></p>\n<ol start=\"7\">\n<li>msdn</li>\n</ol>\n<p>into 140001000</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521102838939.png\" alt=\"image-20210521102838939\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521103139886.png\" alt=\"image-20210521103139886\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521103402857.png\" alt=\"image-20210521103402857\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521103021905.png\" alt=\"image-20210521103021905\"></p>\n<h2 id=\"21-2\"><a href=\"#21-2\" class=\"headerlink\" title=\"21-2\"></a>21-2</h2><p>API IsWow64Process：是否是在64位OS上运行的32位程序</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521103910864.png\" alt=\"image-20210521103910864\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521103950975.png\" alt=\"image-20210521103950975\"></p>\n<ol>\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521104043688.png\" alt=\"image-20210521104043688\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521104119617.png\" alt=\"image-20210521104119617\"></p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>同12-1 动态获取IsWow64Process函数地址</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521104240081.png\" alt=\"image-20210521104240081\"></p>\n<p>rename</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521104259400.png\" alt=\"image-20210521104259400\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521104429084.png\" alt=\"image-20210521104429084\"></p>\n<p>var_10 &#x3D; is64sys ? 1 : 0 </p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p>x86</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521104616300.png\" alt=\"image-20210521104616300\"></p>\n<p>rename</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521104655941.png\" alt=\"image-20210521104655941\"></p>\n<p>into</p>\n<p>将x86资源节中的文件提取到disk sysDIr里</p>\n<p>2参<img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521105157571.png\" alt=\"image-20210521105157571\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521105221290.png\" alt=\"image-20210521105221290\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521105143065.png\" alt=\"image-20210521105143065\"></p>\n<p>esc</p>\n<p>call 401130 提权</p>\n<p>call dw_40A7B0 EnumProcess</p>\n<p>call 4011E0 找IE</p>\n<p>DLL注入</p>\n<p>x64：<strong>【 x.dll   x.exe 】</strong></p>\n<p>提取dll、资源节</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521105738370.png\" alt=\"image-20210521105738370\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521105953306.png\" alt=\"image-20210521105953306\"></p>\n<p>run</p>\n<p>64位OS上的32位程序：对应的系统目录是SysWow64</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521105844762.png\" alt=\"image-20210521105844762\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521110030687.png\" alt=\"image-20210521110030687\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521110120765.png\" alt=\"image-20210521110120765\"></p>\n<p>IDA Lab21-02x.exe</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521110457891.png\" alt=\"image-20210521110457891\"></p>\n<p>dll写入内存，注入</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521110707840.png\" alt=\"image-20210521110707840\"></p>\n<p>string-explorer.exe   xref:  func1090  xref：  main      循环调用</p>\n<p>into 1090：<br>1368： strcmp</p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521111052359.png\" alt=\"image-20210521111052359\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521111128138.png\" alt=\"image-20210521111128138\"></p>\n<p><img src=\"http://cache.itzy8.top/%E3%80%8A%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%9E%E9%AA%8C/image-20210521111800537.png\" alt=\"image-20210521111800537\"></p>\n","text":"1https://down.52pojie.cn/Tools/ 1-1： https://www.virustotal.com/gui/ https://www.virscan.org/ pe.jpg PEiD PEtools 1-2: 脱壳机FUPX—改源文件 sysinter...","link":"","photos":[],"count_time":{"symbolsCount":"21k","symbolsTime":"19 mins."},"categories":[{"name":"逆向","slug":"逆向","count":5,"path":"api/categories/逆向.json"}],"tags":[{"name":"逆向","slug":"逆向","count":4,"path":"api/tags/逆向.json"},{"name":"反汇编","slug":"反汇编","count":1,"path":"api/tags/反汇编.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#1\"><span class=\"toc-text\">1</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#3\"><span class=\"toc-text\">3</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-1\"><span class=\"toc-text\">3-1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-2-dll\"><span class=\"toc-text\">3-2.dll</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-3\"><span class=\"toc-text\">3-3</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-4-%E8%87%AA%E5%88%A0%E9%99%A4\"><span class=\"toc-text\">3-4 自删除</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#5-IDA-Pro\"><span class=\"toc-text\">5 IDA Pro</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%EF%BC%81%EF%BC%81%EF%BC%8112\"><span class=\"toc-text\">！！！12.</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#6-%E8%AF%86%E5%88%AB%E6%B1%87%E7%BC%96%E4%B8%AD%E7%9A%84C%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">6 识别汇编中的C代码结构</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#7-%E5%88%86%E6%9E%90%E6%81%B6%E6%84%8Fwindows%E7%A8%8B%E5%BA%8F\"><span class=\"toc-text\">7 分析恶意windows程序</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#7-3-%E6%84%9F%E6%9F%93%E5%9E%8B\"><span class=\"toc-text\">7-3 感染型</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#9-OD-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90\"><span class=\"toc-text\">9 OD 动态分析</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#9-2-%EF%BC%9F%EF%BC%9F%EF%BC%9F%E9%80%86%E5%90%91shell%E6%8A%80%E6%9C%AF%EF%BC%9F%EF%BC%9F%EF%BC%9F\"><span class=\"toc-text\">9-2      ？？？逆向shell技术？？？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#9-3\"><span class=\"toc-text\">9-3</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6\"><span class=\"toc-text\">6.</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#11-%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E8%A1%8C%E4%B8%BA\"><span class=\"toc-text\">11 恶意代码行为</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#11-1-gina\"><span class=\"toc-text\">11-1 gina</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#11-2-inline-hook-%E9%82%AE%E4%BB%B6addr\"><span class=\"toc-text\">11-2 inline hook , 邮件addr</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#11-3\"><span class=\"toc-text\">11-3</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#12-%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8\"><span class=\"toc-text\">12 隐蔽的恶意代码启动</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#12-1-DLL%E6%B3%A8%E5%85%A5IE-%E5%BC%B9%E7%AA%97\"><span class=\"toc-text\">12-1 DLL注入IE 弹窗</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#12-2-%E8%BF%9B%E7%A8%8B%E6%9B%BF%E6%8D%A2\"><span class=\"toc-text\">12-2 进程替换</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#12-3-keylogger-Hook\"><span class=\"toc-text\">12-3 keylogger  Hook</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#12-4-sfc-os32-dll-%E6%9C%A8%E9%A9%AC%E5%8C%96wupd\"><span class=\"toc-text\">12-4 sfc_os32.dll  木马化wupd</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#13-%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86\"><span class=\"toc-text\">13 数据加密</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#13-1\"><span class=\"toc-text\">13-1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#13-2\"><span class=\"toc-text\">13-2</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#13-3\"><span class=\"toc-text\">13-3</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#14-%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%89%B9%E5%BE%81\"><span class=\"toc-text\">14 恶意代码的网络特征</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#14-1\"><span class=\"toc-text\">14-1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#14-2\"><span class=\"toc-text\">14-2</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#14-3\"><span class=\"toc-text\">14-3</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#15-%E5%AF%B9%E6%8A%97%E5%8F%8D%E6%B1%87%E7%BC%96-F5-space-Data%E3%80%81Code%E3%80%81P-func\"><span class=\"toc-text\">15 对抗反汇编 F5 space Data、Code、P:func</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#15-1\"><span class=\"toc-text\">15-1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#15-2\"><span class=\"toc-text\">15-2</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#15-3\"><span class=\"toc-text\">15-3</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#16-%E5%8F%8D%E8%B0%83%E8%AF%95\"><span class=\"toc-text\">16 反调试</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#16-1-%E8%B0%83%E8%AF%95%E7%8A%B6%E6%80%813%E6%A0%87%E5%BF%97\"><span class=\"toc-text\">16-1 调试状态3标志</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#16-2-TLS%E5%9B%9E%E8%B0%83\"><span class=\"toc-text\">16-2 TLS回调</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#16-3-%E6%97%B6%E9%97%B4%E5%B7%AE-%E7%B1%BB%E4%BC%BC9-2\"><span class=\"toc-text\">16-3 时间差 类似9-2</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#17-%E5%8F%8DVM\"><span class=\"toc-text\">17 反VM</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#17-1-lt-%E2%80%94-7-1\"><span class=\"toc-text\">17-1&lt;—-7-1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#17-2-%E5%B0%9D%E8%AF%95%E7%A6%81%E7%94%A8\"><span class=\"toc-text\">17-2 尝试禁用</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%95%99%E5%BE%85%E5%88%86%E6%9E%90%E3%80%82%E3%80%82%E3%80%82\"><span class=\"toc-text\">留待分析。。。</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#17-3-lt-%E2%80%94-12-2\"><span class=\"toc-text\">17-3&lt;—-12-2</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#18-%E5%8A%A0%E5%A3%B3%E8%84%B1%E5%A3%B3-easy\"><span class=\"toc-text\">18 加壳脱壳  easy</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#18-1-%E5%B0%BE%E9%83%A8%E8%B7%B3%E8%BD%ACOEP\"><span class=\"toc-text\">18-1 尾部跳转OEP</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#18-2-OllyDump-find-OEP-by-section-hop\"><span class=\"toc-text\">18-2 OllyDump: find OEP by section hop</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#18-3-ESP%E5%AE%9A%E5%BE%8B%E8%84%B1%E5%A3%B3%E6%B3%95\"><span class=\"toc-text\">18-3 ESP定律脱壳法</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#18-4-%E5%90%8C3\"><span class=\"toc-text\">18-4 同3</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#18-5-%E5%90%8C\"><span class=\"toc-text\">18-5 同</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#19-Shellcode%E5%88%86%E6%9E%90%E3%80%82%E3%80%82%E3%80%82\"><span class=\"toc-text\">19 Shellcode分析。。。</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#19-1-idc%E8%A7%A3%E5%AF%86-scdbg\"><span class=\"toc-text\">19-1 idc解密 scdbg</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E8%A7%81P654-655%E3%80%82%E3%80%82%E3%80%82\"><span class=\"toc-text\">详见P654-655。。。</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#19-2\"><span class=\"toc-text\">19-2</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E8%A7%81P657-660%E3%80%82%E3%80%82%E3%80%82\"><span class=\"toc-text\">详见P657-660。。。</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#19-3-PDFStreamDumper-%E5%A0%86%E5%96%B7%E5%B0%84\"><span class=\"toc-text\">19-3 PDFStreamDumper 堆喷射</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#20-C-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90\"><span class=\"toc-text\">20 C++代码分析</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#20-1-ECX%E4%BC%A0%E9%80%92%E5%AF%B9%E8%B1%A1%E7%B4%A2%E5%BC%95%EF%BC%9Athis%E6%8C%87%E9%92%88\"><span class=\"toc-text\">20-1  ECX传递对象索引：this指针</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#20-2%E8%99%9A%E5%87%BD%E6%95%B0-FTP\"><span class=\"toc-text\">20-2虚函数 FTP</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#20-3-%E5%BC%82%E5%B8%B8-http-get-post\"><span class=\"toc-text\">20-3 异常 http get post</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#10-WinDbg%E8%B0%83%E8%AF%95%E5%86%85%E6%A0%B8\"><span class=\"toc-text\">10 WinDbg调试内核</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#10-1-%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E6%9D%A5%E5%8A%A0%E8%BD%BD%E9%A9%B1%E5%8A%A8%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%86%85%E6%A0%B8%E6%80%81Reg%E9%94%AE%E5%80%BC-%E7%A6%81%E7%94%A8%E9%98%B2%E7%81%AB%E5%A2%99\"><span class=\"toc-text\">10-1 创建服务来加载驱动：创建内核态Reg键值-禁用防火墙</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#10-2-SSDT-R3-0%E9%80%9A%E4%BF%A1-hook-NtQueryDirectoryFile-FILE-BOTH-DIR-INFORMATION%E2%80%9C%E8%84%B1%E9%93%BE%E2%80%9D%E6%96%87%E4%BB%B6%E9%9A%90%E8%97%8F\"><span class=\"toc-text\">10-2 SSDT(R3-0通信)hook NtQueryDirectoryFile+FILE_BOTH_DIR_INFORMATION“脱链”文件隐藏</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#10-3-eprocess%E7%9A%84ActiveProcessLinks%E8%84%B1%E9%93%BE\"><span class=\"toc-text\">10-3 _eprocess的ActiveProcessLinks脱链</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#21-64%E4%BD%8D%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">21 64位恶意代码</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#21-1\"><span class=\"toc-text\">21-1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#21-2\"><span class=\"toc-text\">21-2</span></a></li></ol></li></ol>","author":{"name":"CodingSeed","slug":"blog-author","avatar":"http://cache.itzy8.top/img/a.jpg","link":"/","description":"","socials":{"github":"https://github.com/codingseed","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"kof97逆向","uid":"6f87183d1eab90b4f00ad401576c1de7","slug":"kof97逆向","date":"2021-02-17T12:24:13.000Z","updated":"2022-08-22T08:54:49.524Z","comments":true,"path":"api/articles/kof97逆向.json","keywords":null,"cover":"http://browser9.qhimg.com/bdm/960_593_0/t019f442db069339645.jpg","text":"1Hack rom 教程https://cloud.tencent.com/developer/article/1176843kof97http://www.winkawaks.org/roms/neogeo/index.htm F5存档F7读档 neogeo:debug dip...","link":"","photos":[],"count_time":{"symbolsCount":"8.1k","symbolsTime":"7 mins."},"categories":[{"name":"逆向","slug":"逆向","count":5,"path":"api/categories/逆向.json"}],"tags":[{"name":"游戏逆向","slug":"游戏逆向","count":1,"path":"api/tags/游戏逆向.json"}],"author":{"name":"CodingSeed","slug":"blog-author","avatar":"http://cache.itzy8.top/img/a.jpg","link":"/","description":"","socials":{"github":"https://github.com/codingseed","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":false},"next_post":{"title":"core","uid":"353cf78a0c7522820ab388e96d2cdefc","slug":"core","date":"2020-09-17T02:21:18.000Z","updated":"2022-08-22T07:47:03.603Z","comments":true,"path":"api/articles/core.json","keywords":null,"cover":"http://browser9.qhimg.com/bdm/480_296_0/t019e08ebfa47d7cc34.jpg","text":"一、【保护模式】 段寄存器有96位，但我们只能看见16位，那如果证明Attribute、Base、Limit的存在呢？ 2、探测Attribute int var &#x3D; 0; __asm &#123; mov ax,ss &#x2F;&#x2F;cs不行 cs是可读 可执...","link":"","photos":[],"count_time":{"symbolsCount":"68k","symbolsTime":"1:02"},"categories":[{"name":"逆向","slug":"逆向","count":5,"path":"api/categories/逆向.json"}],"tags":[{"name":"逆向","slug":"逆向","count":4,"path":"api/tags/逆向.json"}],"author":{"name":"CodingSeed","slug":"blog-author","avatar":"http://cache.itzy8.top/img/a.jpg","link":"/","description":"","socials":{"github":"https://github.com/codingseed","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}